"use strict";(self.webpackChunktorque=self.webpackChunktorque||[]).push([["7038"],{4596:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>t,toc:()=>c,default:()=>h,metadata:()=>i,assets:()=>l,contentTitle:()=>a});var i=JSON.parse('{"id":"workflows/workflows-overview","title":"Torque Workflows","description":"Torque Workflows are a powerful way to automate and orchestrate complex processes within your infrastructure. They allow you to define a series of actions and steps that are executed in a specific order, providing automation capabilities for various operational tasks. Workflows can be triggered by events, scheduled to run at specific times, or executed manually.","source":"@site/docs/workflows/workflows-overview.md","sourceDirName":"workflows","slug":"/workflows/workflows-overview","permalink":"/workflows/workflows-overview","draft":false,"unlisted":false,"editUrl":"https://github.com/QualiTorque/torque-docs/tree/master/docs/workflows/workflows-overview.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Torque Workflows"},"sidebar":"defaultSidebar","previous":{"title":"The Environment YAML","permalink":"/environment-as-code/environment-as-code-yaml"},"next":{"title":"Examples & Use-cases","permalink":"/workflows/workflows-use-cases"}}'),r=s(4848),o=s(4429);let t={sidebar_position:1,title:"Torque Workflows"},a=void 0,l={},c=[{value:"Workflow Discovery",id:"workflow-discovery",level:2},{value:"Usage Example",id:"usage-example",level:2},{value:"Workflow Spec Reference",id:"workflow-spec-reference",level:2},{value:"<code>scope</code>",id:"scope",level:3},{value:"<code>resource-types</code>",id:"resource-types",level:3},{value:"<code>labels-selector</code>",id:"labels-selector",level:3},{value:"<code>triggers</code>",id:"triggers",level:3},{value:"<code>timeout</code>",id:"timeout",level:3},{value:"<code>bindings</code>",id:"bindings",level:3},{value:"Bindings example",id:"bindings-example",level:3},{value:"Environment <code>contract.json</code>",id:"environment-contractjson",level:3},{value:"YAML Example",id:"yaml-example",level:3},{value:"Torque Built-in Workflows",id:"torque-built-in-workflows",level:2},{value:"Built-in workflows",id:"built-in-workflows",level:3},{value:"Available Actions",id:"available-actions",level:4},{value:"Environment References Support",id:"environment-references-support",level:2},{value:"Explore Use-cases",id:"explore-use-cases",level:2}];function d(e){let n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Torque Workflows are a powerful way to automate and orchestrate complex processes within your infrastructure. They allow you to define a series of actions and steps that are executed in a specific order, providing automation capabilities for various operational tasks. Workflows can be triggered by events, scheduled to run at specific times, or executed manually."}),"\n",(0,r.jsx)(n.h2,{id:"workflow-discovery",children:"Workflow Discovery"}),"\n",(0,r.jsxs)(n.p,{children:["Workflow discovery is done in the same way as Blueprints. The YAML files need to be under the ",(0,r.jsx)(n.code,{children:"blueprints/"})," directory in the repository. Torque automatically scans for workflow files and makes them available based on their scope and configuration."]}),"\n",(0,r.jsxs)(n.p,{children:["The Workflow YAML standard is similar to the Blueprint standard. The only addition to the Workflow specification is the ",(0,r.jsx)(n.code,{children:"workflow"})," block, which defines the workflow-specific configuration."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec_version: 2\ndescription: This Workflow will ...\n\nworkflow:\n  # scope possible values are: space, env or env_resource\n  scope: env\n\ngrains: ...\n"})}),"\n",(0,r.jsx)(n.h2,{id:"usage-example",children:"Usage Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec_version: 2\ndescription: Workflow with shell grains for resource management\n\nworkflow:\n  scope: env_resource\n  resource-types: aws_instance\n  triggers:\n    - type: manual\n\ninputs:\n  agent:\n    type: agent\n\ngrains:\n  resource_check:\n    kind: shell\n    spec:\n      agent:\n        name: '{{ .inputs.agent }}'\n      activities:\n        deploy:\n          commands:\n            - 'echo \"Checking resource: {{ .bindings.attributes.arn }}\"'\n"})}),"\n",(0,r.jsx)(n.h2,{id:"workflow-spec-reference",children:"Workflow Spec Reference"}),"\n",(0,r.jsx)(n.h3,{id:"scope",children:(0,r.jsx)(n.code,{children:"scope"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"scope"})," field in a Torque workflow determines where the workflow is available. There are two possible values for the ",(0,r.jsx)(n.code,{children:"scope"})," field:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"space"}),": Workflows with this scope are available at the space level, and can be triggered and executed without any dependencies."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"env"}),": Workflows with this scope are available at the environment level. This means that they can be triggered and executed for the entire environment. These workflows can be used to automate and orchestrate processes that involve multiple resources within the environment."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"env_resource"}),": Workflows with this scope will be available at the resource level (e.g. for a VM or DB). The type of resource for which the workflow will be available is defined by the ",(0,r.jsx)(n.code,{children:"resource-types"})," field. Only resources that match the specified resource types will have access to these workflows. This allows for more granular control and customization of workflows based on specific resource types."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"resource-types",children:(0,r.jsx)(n.code,{children:"resource-types"})}),"\n",(0,r.jsxs)(n.p,{children:["When scoping a the workflow to an ",(0,r.jsx)(n.code,{children:"env_resource"}),", the ",(0,r.jsx)(n.code,{children:"resource-types"})," field allow to attach that workflow to the specified resource types."]}),"\n",(0,r.jsx)(n.p,{children:"In this example, we scope this workflow only AWS EC2 instances resources:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec_version: 2\ndescription: This Resource Workflow will ...\n\nworkflow:\n  scope: env_resource\n  # note: more than one resource type can be specified in CSV format.\n  resource-types: aws_instance\n\ngrains: ...\n"})}),"\n",(0,r.jsx)(n.p,{children:"By specifying the appropriate scope for your workflows, you can ensure that they are available and applicable to the desired level of your infrastructure. Whether you need to automate processes at the environment level or target specific resources, Torque workflows provide the flexibility to meet your automation needs."}),"\n",(0,r.jsx)(n.h3,{id:"labels-selector",children:(0,r.jsx)(n.code,{children:"labels-selector"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"labels-selector"}),' field can be used to "attach" workflows to ',(0,r.jsx)(n.code,{children:"Blueprints"})," or running ",(0,r.jsx)(n.code,{children:"Environments"})," that have matching labels."]}),"\n",(0,r.jsxs)(n.p,{children:["In case ",(0,r.jsx)(n.code,{children:"labels-selector"})," field is not defined, the workflow will be available to all of the ",(0,r.jsx)(n.code,{children:"Blueprints"})," and running ",(0,r.jsx)(n.code,{children:"Environments"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"labels-selector"})," supports two types of conditions:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"and"})," condition"]}),": Use the ",(0,r.jsx)(n.code,{children:"and"})," operator between labels to specify that all labels must match."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"or"})," condition"]}),": Use a comma ",(0,r.jsx)(n.code,{children:","})," between labels to specify that any of the labels can match."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["You can only choose one type of condition (",(0,r.jsx)(n.code,{children:"and"})," or ",(0,r.jsx)(n.code,{children:","}),") and cannot mix them in the same ",(0,r.jsx)(n.code,{children:"labels-selector"}),"."]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec_version: 2\ndescription: This Workflow will ...\n\nworkflow:\n  scope: env\n  # example of 'and' condition: all labels must match\n  labels-selector: label1:value1 and label2\n  # example of 'or' condition: any label can match\n  # labels-selector: label1:value1, label2\n\ngrains: ...\n"})}),"\n",(0,r.jsx)(n.h3,{id:"triggers",children:(0,r.jsx)(n.code,{children:"triggers"})}),"\n",(0,r.jsx)(n.p,{children:"Workflows can be triggered by various types of events or schedules:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cron"}),": Schedules based on cron expressions.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"overridable"}),": Optional field to allow end-users to override the cron"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"manual"}),": Manually triggered workflows, optionally restricted to specific user groups.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"groups"}),": Optional field to allow only users in the specified groups to run the workflow"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"event"}),": Environment events can be events such as drift detected, updates detected, approval requests, and more. The events include:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Drift Detected"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Updates Detected"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Approval Request Approved"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Approval Request Denied"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Approval Request Cancelled"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Environment Ended"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Environment Launched"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Environment Active With Error"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Environment Ending Failed"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Environment Force Ended"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Environment Extended"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Collaborator Added"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Environment Idle"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec_version: 2\ndescription: ...\n\nworkflow:\n  scope: env\n\n  triggers:\n    - type: event\n      event:\n        - 'Approval Request Approved'\n        - 'Approval Request Cancelled'\n\n    - type: cron \n      cron: '0 22 * * *' # every day at 22:00\n      overridable: true # Allow end-users to override the cron\n\n    - type: manual \n      groups: # Optional, allow only users in the \"Admin\" group to run the workflow\n        - 'Admins'\n   \ninputs: ...\noutputs: ...\ngrains: ...\n"})}),"\n",(0,r.jsx)(n.h3,{id:"timeout",children:(0,r.jsx)(n.code,{children:"timeout"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"timeout"})," field allows you to specify the maximum duration (in minutes) that a workflow is allowed to run before it is automatically terminated. This helps prevent workflows from running indefinitely and consuming resources."]}),"\n",(0,r.jsx)(n.p,{children:"The timeout value can be specified as either a string or an integer, and supports Liquid templating for dynamic values (for example, from inputs or parameters)."}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"The minimum timeout value is 5 minutes. This ensures that the workflow environment has sufficient time to initialize and start deployment properly."})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example - static timeout:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec_version: 2\ndescription: Workflow with timeout\n\nworkflow:\n  scope: env \n  timeout: '7'  # 7 minutes timeout as string\n\ngrains: ...\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example - dynamic timeout using input:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec_version: 2\ndescription: Workflow with dynamic timeout\n\ninputs:\n  workflow_timeout:\n    type: string\n    default: '15'\n\nworkflow:\n  scope: env\n  timeout: '{{ .inputs.workflow_timeout }}'  # Dynamic timeout from input\n\ngrains: ...\n"})}),"\n",(0,r.jsx)(n.h3,{id:"bindings",children:(0,r.jsx)(n.code,{children:"bindings"})}),"\n",(0,r.jsx)(n.p,{children:"In a workflow, you can define bindings to access environment and resource information. Bindings are automatic variables that provide context to the workflow. The available bindings depend on the scope of the workflow."}),"\n",(0,r.jsxs)(n.p,{children:["For both ",(0,r.jsx)(n.code,{children:"env"})," and ",(0,r.jsx)(n.code,{children:"env_resource"}),' scope workflows, accessing the env ("bound entity") inputs and outputs, will be as follow:']}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"{{ .bindings.inputs.<the env input name> }}"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"{{ .bindings.outputs.<the env output name> }}"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["For ",(0,r.jsx)(n.code,{children:"env"})," scoped workflow, the env ",(0,r.jsx)(n.code,{children:"introspection"})," can be access like so:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"{{ bindings.resource_type.<the resource type>.attributes.<the attribute>}}"})}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"If more than 1 resource type like this exists in this environment, then we take the first one."})}),"\n",(0,r.jsxs)(n.p,{children:["For ",(0,r.jsx)(n.code,{children:"env_resource"})," scoped workflow, the env ",(0,r.jsx)(n.code,{children:"introspection"})," can be access like so:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"{{ bindings.attributes.<the attribute>}}"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"bindings-example",children:"Bindings example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec_version: 2\ndescription: workflow with \"env\" scope example\n\nworkflow:\n  scope: env\n  triggers:\n    - type: manual\n \ninputs:\n  agent:\n    type: agent\n    default: prod\n\ngrains:\n  shell_grain:\n    kind: shell\n    spec:\n      agent:\n        name: '{{.inputs.agent}}'\n      activities:\n        deploy:\n          commands:\n            - 'echo \"another thing - {{.bindings.resource_type.random_string.attributes.result}}\"'\n            - 'echo \"another thing - {{.bindings.resource_type.random_id.attributes.hex}}\"'\n            - 'echo \"another thing - {{.bindings.resource_type.null_resource.attributes.id}}\"'\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec_version: 2\ndescription: workflow with \"env_resource\" scope example\n\nworkflow:\n  scope: env_resource\n  resource-selector: aws_s3_bucket\n  triggers:\n    - type: manual\n \ninputs:\n  agent:\n    type: agent\ngrains:\n  shell_me:\n    kind: shell\n    spec:\n      agent:\n        name: '{{.inputs.agent}}'\n      activities:\n        deploy:\n          commands:\n            - 'echo \"---\x3e> {{.bindings.attributes.arn}}\"'\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"environment-contractjson",children:["Environment ",(0,r.jsx)(n.code,{children:"contract.json"})]}),"\n",(0,r.jsxs)(n.p,{children:["When a workflow is executed with a specific scope, the environment ",(0,r.jsx)(n.strong,{children:"context"})," JSON object is provided in a file called ",(0,r.jsx)(n.code,{children:"contract.json"}),". This file is accessible from the Runner and contains information about the environment, such as its ID, name, owner email, inputs and all grains introspection data."]}),"\n",(0,r.jsxs)(n.p,{children:["For workflows with scope ",(0,r.jsx)(n.code,{children:"env"}),", the following automatic variables are available:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"bindings.environment_id"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["For workflows with scope ",(0,r.jsx)(n.code,{children:"env_resource"}),", the following automatic variables are available:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"bindings.environment_id"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"bindings.grain_path"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"bindings.resource_id"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The binding variables will provide the relevant context to access the relevant resource introspection data in the ",(0,r.jsx)(n.code,{children:"contract"})," object available in the workflow."]}),"\n",(0,r.jsxs)(n.p,{children:["Here is an example of a ",(0,r.jsx)(n.code,{children:"contract.json"})," file:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "id": "kuzxqUlGSM4C",\n  "name": "EC2",\n  "owner_email": "dev@quali.com",\n  "last_used": "2023-10-07T11:57:18.6865654Z",\n  "inputs": [\n    {\n      "name": "instance_name",\n      "type": "string",\n      "value": "EC2",\n      "sensitive": false,\n      "description": "Name for the EC2 instance"\n    },\n    {\n      "name": "aws_region",\n      "type": "string",\n      "value": "eu-west-1",\n      "sensitive": false,\n      "description": "AWS region to create resources in"\n    },\n    {\n      "name": "instance_ami",\n      "type": "string",\n      "value": "ami-016587dea5af03adb",\n      "sensitive": false,\n      "description": "AMI ID for the EC2 instance"\n    },\n    {\n      "name": "instance_type",\n      "type": "string",\n      "value": "t2.micro",\n      "sensitive": false,\n      "description": "Instance type for the EC2 instance"\n    },\n    {\n      "name": "key_pair_name",\n      "type": "string",\n      "value": "key-pair",\n      "sensitive": false,\n      "description": "Name of the key pair"\n    },\n    {\n      "name": "agent",\n      "type": "agent",\n      "value": "cloud-agent",\n      "sensitive": false,\n      "description": null\n    }\n  ],\n  "grains": {\n    "ec2": {\n      "kind": "terraform",\n      "path": "ec2",\n      "outputs": {\n        "instance_availability_zone": "eu-west-1c",\n        "instance_id": "i-044264d8ee1c50f3d",\n        "instance_private_ip": "172.31.28.188",\n        "instance_public_ip": "18.203.238.11",\n        "instance_subnet_id": "subnet-0c1abbaed3cdbdb66"\n      }\n    },\n    "root_blueprint": {\n      "kind": "blueprint",\n      "path": "root_blueprint",\n      "outputs": {\n        "ec2_instance_availability_zone": "eu-west-1c",\n        "ec2_instance_id": "i-044264d8ee1c50f3d",\n        "ec2_instance_private_ip": "172.31.28.188",\n        "ec2_instance_public_ip": "18.203.238.11",\n        "ec2_instance_subnet_id": "subnet-0c1abbaed3cdbdb66",\n        "ec2_instance_vpc_id": ""\n      }\n    }\n  },\n  "resources": [\n    {\n      "grain_path": "ec2",\n      "resource_name": "my_ec2_instance",\n      "resource_type": "aws_instance",\n      "identifier": "aws_instance.my_ec2_instance",\n      "attributes": {\n        "id": "i-044264d8ee1c50f3d",\n        "ami": "ami-016587dea5af03adb",\n        "arn": "arn:aws:ec2:eu-west-1:<accout-id>:instance/i-044264d8ee1c50f3d",\n        "tags": "..",\n        "host_id": "",\n        "tenancy": "default",\n        "key_name": "key-pair",\n        "tags_all": "..",\n        "timeouts": "",\n        "public_ip": "18.203.238.11",\n        "subnet_id": "subnet-0c1abbaed3cdbdb66",\n        "user_data": "",\n        "monitoring": "False",\n        "private_ip": "172.31.28.188",\n        "public_dns": "ec2-18-203-238-11.eu-west-1.compute.amazonaws.com",\n        "cpu_options": "[\\n  {\\n    \\"amd_sev_snp\\": \\"\\",\\n    \\"core_count\\": 1,\\n    \\"threads_per_core\\": 1\\n  }\\n]",\n        "hibernation": "False",\n        "outpost_arn": "",\n        "private_dns": "ip-172-31-28-188.eu-west-1.compute.internal",\n        "volume_tags": "",\n        "ebs_optimized": "False",\n        "instance_type": "t2.micro",\n        "******_data": "",\n        "cpu_core_count": "1",\n        "instance_state": "running",\n        "ipv6_addresses": "[]",\n        "enclave_options": "[\\n  {\\n    \\"enabled\\": false\\n  }\\n]",\n        "launch_template": "[]",\n        "placement_group": "",\n        "security_groups": "[\\n  \\"default\\"\\n]",\n        "disable_api_stop": "False",\n        "ebs_block_device": "[]",\n        "metadata_options": "[\\n  {\\n    \\"http_endpoint\\": \\"enabled\\",\\n    \\"http_protocol_ipv6\\": \\"disabled\\",\\n    \\"http_put_response_hop_limit\\": 1,\\n    \\"http_tokens\\": \\"optional\\",\\n    \\"instance_metadata_tags\\": \\"disabled\\"\\n  }\\n]",\n        "user_data_base64": "",\n        "availability_zone": "eu-west-1c",\n        "get_******_data": "False",\n        "network_interface": "[]",\n        "root_block_device": "[\\n  {\\n    \\"delete_on_termination\\": true,\\n    \\"device_name\\": \\"/dev/sda1\\",\\n    \\"encrypted\\": false,\\n    \\"iops\\": 100,\\n    \\"kms_key_id\\": \\"\\",\\n    \\"tags\\": {},\\n    \\"tags_all\\": {},\\n    \\"throughput\\": 0,\\n    \\"volume_id\\": \\"vol-00160f2bba38f64ea\\",\\n    \\"volume_size\\": 8,\\n    \\"volume_type\\": \\"gp2\\"\\n  }\\n]",\n        "source_dest_check": "True",\n        "instance_lifecycle": "",\n        "ipv6_address_count": "0",\n        "maintenance_options": "[\\n  {\\n    \\"auto_recovery\\": \\"default\\"\\n  }\\n]",\n        "cpu_threads_per_core": "1",\n        "credit_specification": "[\\n  {\\n    \\"cpu_credits\\": \\"standard\\"\\n  }\\n]",\n        "iam_instance_profile": "",\n        "secondary_private_ips": "[]",\n        "ephemeral_block_device": "[]",\n        "vpc_security_group_ids": "[\\n  \\"sg-085399a72b47e21e3\\"\\n]",\n        "disable_api_termination": "False",\n        "host_resource_group_arn": "",\n        "instance_market_options": "[]",\n        "private_dns_name_options": "[\\n  {\\n    \\"enable_resource_name_dns_a_record\\": false,\\n    \\"enable_resource_name_dns_aaaa_record\\": false,\\n    \\"hostname_type\\": \\"ip-name\\"\\n  }\\n]",\n        "spot_instance_request_id": "",\n        "placement_partition_number": "0",\n        "associate_public_ip_address": "True",\n        "user_data_replace_on_change": "False",\n        "primary_network_interface_id": "eni-03e8445441f4ddb2e",\n        "capacity_reservation_specification": "[\\n  {\\n    \\"capacity_reservation_preference\\": \\"open\\",\\n    \\"capacity_reservation_target\\": []\\n  }\\n]",\n        "instance_initiated_shutdown_behavior": "stop"\n      }\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"yaml-example",children:"YAML Example"}),"\n",(0,r.jsx)(n.p,{children:"Below is a complete example of a workflow running shell scripts:```yaml\nspec_version: 2\ndescription: Workflow with shell grains"}),"\n",(0,r.jsx)(n.p,{children:"workflow:\nscope: env_resource"}),"\n",(0,r.jsx)(n.h1,{id:"note-more-than-one-resource-type-can-be-specified-in-csv-format",children:"note: more than one resource type can be specified in CSV format."}),"\n",(0,r.jsx)(n.p,{children:"resource-types: aws_instance,azurerm_linux_virtual_machine"}),"\n",(0,r.jsx)(n.h1,{id:"note-more-than-one-label-can-be-specified-in-csv-format",children:"note: more than one label can be specified in CSV format."}),"\n",(0,r.jsx)(n.p,{children:"labels-selector: VMs"}),"\n",(0,r.jsx)(n.p,{children:"inputs:\ninput1:\ntype: string\ndefault: 'in1'\ninput2:\ntype: string\nagent:\ntype: agent"}),"\n",(0,r.jsxs)(n.p,{children:["outputs:\nresource_state:\nvalue: '{{ .grains.helper.activities.deploy.commands.print.outputs.state_tr }}'",(0,r.jsx)(n.br,{}),"\n","input1:\nvalue: '{{ .inputs.input1 }}'"]}),"\n",(0,r.jsx)(n.p,{children:"grains:\nhelper:\nkind: shell\nspec:\nagent:\nname: '{{ .inputs.agent }}'\nfiles:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["source: scripts\npath: scripts/print-resource-2.sh\nactivities:\ndeploy:\ncommands:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["name: print\ncommand:  'source print-resource-2.sh {{ .bindings.resource_id }} {{ .bindings.grain_path }}'\noutputs:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"state_tr"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"job2:\nkind: shell\ndepends-on: helper\nspec:\nagent:\nname: '{{ .inputs.agent }}'\nactivities:\ndeploy:\ncommands:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["name: print",(0,r.jsx)(n.br,{}),"\n","command:  'echo \"{{ .grains.helper.activities.deploy.commands.print.outputs.state_tr }}\"'"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'\n**Shell script example:**\n\n```shell\nresource_id=$1\ngrain_path=$2\ncontract_path=$CONTRACT_FILE_PATH\n\n# will print the attribute "power_state" of the resource\nstate=$(jq --arg ResourceId "$resource_id" --arg GrainPath "$grain_path" \'.resources[] | select(.identifier == $ResourceId and .grain_path == $GrainPath) | .attributes | .power_state\' $contract_path)\n\nexport state_tr=`echo -n $state | tr -d \'"\'`\n\necho ""\necho "extracted values:"\necho "------------------"\necho "state_tr: $state_tr"\necho "------------------"\necho ""\n\ncat $CONTRACT_FILE_PATH\necho $state_tr\nexport $state_tr\n'})}),"\n",(0,r.jsx)(n.h2,{id:"torque-built-in-workflows",children:"Torque Built-in Workflows"}),"\n",(0,r.jsx)(n.h3,{id:"built-in-workflows",children:"Built-in workflows"}),"\n",(0,r.jsx)(n.p,{children:"Torque provides some out-of-the-box workflows for you to use."}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["All the built-in workflows are Ansible-based and available here: ",(0,r.jsx)(n.a,{href:"https://github.com/QualiTorque/torque-actions",children:"https://github.com/QualiTorque/torque-actions"})]})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"In built-in workflows (with env_resource scope), only one grain is allowed to be specified."}),"\n",(0,r.jsx)(n.li,{children:"One action will be run per one introspection resource."}),"\n"]})}),"\n",(0,r.jsxs)(n.p,{children:["In order to use the built-in workflows, a ",(0,r.jsx)(n.code,{children:"built-in"})," field is required and under source.path you need to point to the relevant action. For example:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"built-in: true\nsource:\n  path: https://github.com/QualiTorque/torque-actions.git//resource/<action>.yaml\n"})}),"\n",(0,r.jsx)(n.h4,{id:"available-actions",children:"Available Actions"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"The available built-in actions:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aws-power-on-ec2-tf"}),": This workflow is used to power on an EC2 instance in AWS that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aws-power-off-ec2-tf"}),": This workflow is used to power off an EC2 instance in AWS that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aws-restart-ec2-tf"}),": This workflow is used to restart an EC2 instance in AWS that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-power-on-vm-tf"}),": This workflow is used to power on a virtual machine in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-power-off-vm-tf"}),": This workflow is used to power off a virtual machine in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-restart-vm-tf"}),": This workflow is used to restart a virtual machine in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"netapp-cvo-azure-power-on-vm-tf"}),": This workflow is used to power on a NetApp Cloud Volumes ONTAP virtual machine in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"netapp-cvo-azure-deallocate-vm-tf"}),": This workflow is used to deallocate a NetApp Cloud Volumes ONTAP virtual machine in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"netapp-cvo-azure-restart-vm-tf"}),": This workflow is used to restart a NetApp Cloud Volumes ONTAP virtual machine in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aws-temp-stop-rds-tf"}),": This workflow is used to temporarily stop an RDS instance in AWS that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aws-delete-rds-tf"}),": This workflow is used to delete an RDS instance in AWS that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-delete-mariadb-tf"}),": This workflow is used to delete a MariaDB server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-delete-mysql-tf"}),": This workflow is used to delete a MySQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-delete-postgresql-tf"}),": This workflow is used to delete a PostgreSQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-delete-flexible-mysql-tf"}),": This workflow is used to delete a flexible MySQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-delete-flexible-postgresql-tf"}),": This workflow is used to delete a flexible PostgreSQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-delete-mssql-tf"}),": This workflow is used to delete an MSSQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-stop-mysql-server-tf"}),": This workflow is used to stop a MySQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-start-mysql-server-tf"}),": This workflow is used to start a MySQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-stop-mariadb-server-tf"}),": This workflow is used to stop a MariaDB server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-start-mariadb-server-tf"}),": This workflow is used to start a MariaDB server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-stop-flexible-postgresql-server-tf"}),": This workflow is used to stop a flexible PostgreSQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-start-flexible-postgresql-server-tf"}),": This workflow is used to start a flexible PostgreSQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-stop-flexible-mysql-server-tf"}),": This workflow is used to stop a flexible MySQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-start-flexible-mysql-server-tf"}),": This workflow is used to start a flexible MySQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-restart-mariadb-server-tf"}),": This workflow is used to restart a MariaDB server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-restart-mysql-server-tf"}),": This workflow is used to restart a MySQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-restart-flexible-mysql-server-tf"}),": This workflow is used to restart a flexible MySQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-restart-flexible-postgresql-server-tf"}),": This workflow is used to restart a flexible PostgreSQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-restart-postgresql-server-tf"}),": This workflow is used to restart a PostgreSQL server in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aws-start-rds-tf"}),": This workflow is used to start an RDS instance in AWS that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aws-power-on-ec2-cfn"}),": This workflow is used to power on an EC2 instance in AWS that was provisioned using CloudFormation.."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aws-power-off-ec2-cfn"}),": This workflow is used to power off an EC2 instance in AWS that was provisioned using CloudFormation.."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aws-restart-ec2-cfn"}),": This workflow is used to restart an EC2 instance in AWS that was provisioned using CloudFormation.."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aws-temp-stop-rds-cfn"}),": This workflow is used to temporarily stop an RDS instance in AWS that was provisioned using CloudFormation.."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aws-start-rds-cfn"}),": This workflow is used to start an RDS instance in AWS that was provisioned using CloudFormation.."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-pause-aks-tf"}),": This workflow is used to pause an AKS cluster in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"azure-resume-aks-tf"}),": This workflow is used to resume an AKS cluster in Azure that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aws-pause-eks-tf"}),": This workflow is used to pause an EKS cluster in AWS that was provisioned using Terraform."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aws-resume-eks-tf"}),": This workflow is used to resume an EKS cluster in AWS that was provisioned using Terraform."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example of built-in workflow:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec_version: 2\ndescription: This workflow pauses an EKS cluster on-demand\n\nworkflow:\n  scope: env\n  resource-types: eks_cluster\n  triggers:\n    - type: manual\n\ninputs:\n  agent:\n    type: agent\n    default: cloud-agent\n\ngrains:\n  pause_eks:\n    kind: ansible\n    spec:\n      built-in: true\n      source:\n        path: https://github.com/QualiTorque/torque-actions.git//resource/aws-pause-eks-tf.yaml\n      agent:\n        name: '{{ .inputs.agent }}'\n"})}),"\n",(0,r.jsx)(n.h2,{id:"environment-references-support",children:"Environment References Support"}),"\n",(0,r.jsxs)(n.p,{children:["Workflows support ",(0,r.jsx)(n.code,{children:"env_references"})," similar to blueprints, allowing workflows to reference and consume published environments. For more information about environment publishing and references, see ",(0,r.jsx)(n.a,{href:"/environment-services/environment-publishing",children:"Environment Publishing"}),"."]}),"\n",(0,r.jsx)(n.admonition,{title:"Supported scenarios",type:"info",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Manual workflows"}),": Workflows with ",(0,r.jsx)(n.code,{children:"env_references"})," can be launched manually, and users can specify the environment reference values during execution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Automatic workflows on launch"}),": Environments with automatic workflows (cron/event triggers) that have ",(0,r.jsx)(n.code,{children:"env_references"})," defined can be launched successfully with the reference values specified at environment launch time"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Post-launch automatic workflows"}),": Automatic workflows with ",(0,r.jsx)(n.code,{children:"env_references"})," that are attached to an active environment after its launch (e.g., when enabled in a space) will not be able to run because there is no mechanism to specify ",(0,r.jsx)(n.code,{children:"env_references"})," values after the environment is already active"]}),"\n"]})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example workflow with environment references:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec_version: 2\ndescription: Workflow that references a shared VPC environment\n\nenv_references:\n  shared_vpc:\n    labels-selector: 'vpc-shared'\n\nworkflow:\n  scope: env\n  triggers:\n    - type: manual\n\ninputs:\n  agent:\n    type: agent\n\ngrains:\n  network_check:\n    kind: shell\n    spec:\n      agent:\n        name: '{{ .inputs.agent }}'\n      activities:\n        deploy:\n          commands:\n            - 'echo \"Using VPC: {{ .env_references.shared_vpc.outputs.vpc_id }}\"'\n"})}),"\n",(0,r.jsx)(n.h2,{id:"explore-use-cases",children:"Explore Use-cases"}),"\n",(0,r.jsxs)(n.p,{children:["To explore the different use-cases ",(0,r.jsx)(n.a,{href:"workflows-use-cases",children:"click here"})]})]})}function h(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},4429:function(e,n,s){s.d(n,{R:()=>t,x:()=>a});var i=s(6540);let r={},o=i.createContext(r);function t(e){let n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);