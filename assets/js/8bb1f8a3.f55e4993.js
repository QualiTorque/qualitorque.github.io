"use strict";(self.webpackChunktorque=self.webpackChunktorque||[]).push([[6546],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=p(n),d=a,h=m["".concat(l,".").concat(d)]||m[d]||u[d]||r;return n?o.createElement(h,i(i({ref:t},c),{},{components:n})):o.createElement(h,i({ref:t},c))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:a,i[1]=s;for(var p=2;p<r;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8091:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var o=n(7462),a=(n(7294),n(3905));const r={sidebar_position:15,title:"Environment Annotations"},i=void 0,s={unversionedId:"environment-services/environment-annotations",id:"environment-services/environment-annotations",title:"Environment Annotations",description:"Environment Annotations: What They Are and How you can leverage them to optimize processes",source:"@site/docs/environment-services/environment-annotations.md",sourceDirName:"environment-services",slug:"/environment-services/environment-annotations",permalink:"/environment-services/environment-annotations",editUrl:"https://github.com/QualiTorque/torque-docs/tree/master/docs/environment-services/environment-annotations.md",tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15,title:"Environment Annotations"},sidebar:"torqueSidebar",previous:{title:"Existing Environment Import",permalink:"/environment-services/Import"},next:{title:"Application Orchestration",permalink:"/example-blueprints/Multi-Technology Orchestration"}},l={},p=[{value:"<strong>Environment Annotations: What They Are and How you can leverage them to optimize processes</strong>",id:"environment-annotations-what-they-are-and-how-you-can-leverage-them-to-optimize-processes",level:2},{value:"<strong>To create an environment annotation:</strong>",id:"to-create-an-environment-annotation",level:2}],c={toc:p},m="wrapper";function u(e){let{components:t,...r}=e;return(0,a.kt)(m,(0,o.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"environment-annotations-what-they-are-and-how-you-can-leverage-them-to-optimize-processes"},(0,a.kt)("strong",{parentName:"h2"},"Environment Annotations: What They Are and How you can leverage them to optimize processes")),(0,a.kt)("p",null,"Environment annotations are labels or metadata that can be added to environments to provide additional information about them. Annotations can be used to define the purpose, status, or configuration of an environment, as well as to track changes or updates."),(0,a.kt)("p",null,"Annotations in Torque are key-value pairs that can be added to an environment or resource using a specific syntax or format. They can be used to add descriptive information, such as the description of an environment, or to provide dynamic updates, such as the current status of a deployment or the results of a test."),(0,a.kt)("p",null,"Annotations can help teams manage and organize environments in Torque by providing an easy way to track and communicate important information about them. For example, annotations can be used to indicate the power-state status of virtual machines in the environment. "),(0,a.kt)("p",null,"Environment annotations are a powerful tool for managing and organizing environments, and can help teams streamline their software development and testing processes by providing clear and concise information about the resources they are working with."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("img",{alt:"Locale Dropdown",src:n(3343).Z,width:"1311",height:"461"}))),(0,a.kt)("h2",{id:"to-create-an-environment-annotation"},(0,a.kt)("strong",{parentName:"h2"},"To create an environment annotation:")),(0,a.kt)("p",null,"Since environment annotations are ",(0,a.kt)("strong",{parentName:"p"},"dynamic")," attributes of the environments, Torque uses ",(0,a.kt)("strong",{parentName:"p"},"rego")," files and the policy engine to evaluate the annotation upon any chance in the environment. "),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Step 1: Create a rego file")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"In your git repository, create a rego file with ",(0,a.kt)("strong",{parentName:"li"},"torque.annotation")," package name."),(0,a.kt)("li",{parentName:"ol"},"The ",(0,a.kt)("strong",{parentName:"li"},"input")," to the rego evaluation is the ",(0,a.kt)("strong",{parentName:"li"},"introspection")," data from the environment. i.e a list of all the environment resources and their attributes, as a json object. The object will vary depending on the exact environment resources, but its overall structure will be as follows:",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"title=introspection.json",title:"introspection.json"},'{\n"introspection_resources": [\n  {\n    "attributes": {\n      "att1": "att1",\n      "att2":  "{\\"key\\": \\"value\\"}"\n      ...\n    }\n  },\n  {\n    "attributes": {\n      ...\n    }\n  },\n  {\n    // more resources\n  }\n]\n}\n'))),(0,a.kt)("li",{parentName:"ol"},'Using the introspection input, create your rule for the annotation and return an object named "set_annotations" with the following structure:',(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},'  "set_annotations" = ["key" : "key1", "value" : "value1"]\n')))),(0,a.kt)("p",null,'Let\'s take a look at a full example of how this rego file would look. In this evaluation file, we are evaluating the power state of virtual machines inside the environment. If there is even one virtual machine which is running, we will annotate the environment with "Power:On" annotation. If all of the virtual machines are stopped, the annotation will be "Power:Off".'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"title=power_state.rego",title:"power_state.rego"},'package torque.annotations  // Use this as the first line to signal to Torque this file is for evaluating environment annotations.\n\ndefault set_annotations = [{"key": "power", "value": "off"}] // Unless we will find at least one running VM, we will return this default annotation of "Power:Off". \n\nset_annotations = [{"key": "power", "value": "on"}] { \n\n\xa0 resources_with_power_state_running = {r | r = input.introspection_resources[_]; r.attributes.power_state == "running"} // In this case, every virtual machine has an attribute named "power_state" which can be either "running" or "stopped". We are iterating all power_state attribute values which equal to "running".\n\xa0 count(resources_with_power_state_running) > 0 // If there is at least 1, we return "Power:On".\n\n}\n')),(0,a.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),(0,a.kt)("strong",{parentName:"h5"},"Note"))),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},'Currently the only supported annotations are "power:on", "power:off" and "power:torque.remove". We will add more annotations and open it for custom annotations soon.\n"torque.remove" is a general annotation value which may be used with any key. It signals to Torque to remove the annotation completely from the environment. A good example of when to use it is when the environment is ended.'))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Step 2: Import the rego file into Torque ")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"If the git repository where the relevant rego file resides was not yet connected to Torque, perform the following :"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Go to ",(0,a.kt)("strong",{parentName:"p"},"Administration > Policy Repositories")," and click ",(0,a.kt)("strong",{parentName:"p"},"Add a Repository"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Select the git repository, specify the repository's URL, and give it a name."),(0,a.kt)("blockquote",{parentName:"li"},(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("img",{alt:"Locale Dropdown",src:n(2517).Z,width:"839",height:"563"})))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Click ",(0,a.kt)("strong",{parentName:"p"},"Connect"),". Provide authorization credentials if the repository is private."),(0,a.kt)("p",{parentName:"li"},"A green checkmark next to the repository's URL indicates that the repository has been added successfully."),(0,a.kt)("blockquote",{parentName:"li"},(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("img",{alt:"Locale Dropdown",src:n(986).Z,width:"843",height:"569"})))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"On the added (or existing) repository where the file resides, Click ",(0,a.kt)("strong",{parentName:"p"},"Discover Policies"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Select the policies you want to import into Torque, and click ",(0,a.kt)("strong",{parentName:"p"},"Generate Policies"),"."),(0,a.kt)("blockquote",{parentName:"li"},(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("img",{alt:"Locale Dropdown",src:n(4069).Z,width:"870",height:"687"}))),(0,a.kt)("p",{parentName:"li"}," The policies are displayed in the ",(0,a.kt)("strong",{parentName:"p"},"Policies")," page."),(0,a.kt)("blockquote",{parentName:"li"},(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("img",{alt:"Locale Dropdown",src:n(489).Z,width:"1228",height:"527"}),"    "))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Click a generated policy and edit the details."),(0,a.kt)("p",{parentName:"li"},"a. Optionally change the ",(0,a.kt)("strong",{parentName:"p"},"Name"),", and provide a ",(0,a.kt)("strong",{parentName:"p"},"Description"),"."),(0,a.kt)("p",{parentName:"li"},"b. In ",(0,a.kt)("strong",{parentName:"p"},"Spaces"),", set the scope of the policy - ",(0,a.kt)("strong",{parentName:"p"},"All spaces")," or specific ones.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Click ",(0,a.kt)("strong",{parentName:"p"},"Save"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Enable")," the policy."),(0,a.kt)("blockquote",{parentName:"li"},(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("img",{alt:"Locale Dropdown",src:n(7534).Z,width:"653",height:"530"}))))))}u.isMDXComponent=!0},3343:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/annotations-ff17e5478fcda713408d4ec92bce4569.png"},7534:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/enable-custom-policy-bd8f5f27af9c7e3ed0ff6f938ab68c54.png"},489:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/new-custom-policies-ee1862d853e954b3ca643024e4053ac4.png"},4069:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/policy-import-1e534f31272a694d47469d21a25fa9f8.png"},986:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/repository-connection-350b4cf7d2439d64b07f6e7e57da6e1a.png"},2517:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/repository-information-9d0853511f5bfb488af46cef399abf96.png"}}]);