"use strict";(self.webpackChunktorque=self.webpackChunktorque||[]).push([[945],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return c}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=u(n),c=i,h=m["".concat(l,".").concat(c)]||m[c]||d[c]||r;return n?a.createElement(h,s(s({ref:t},p),{},{components:n})):a.createElement(h,s({ref:t},p))}));function c(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,s=new Array(r);s[0]=m;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:i,s[1]=o;for(var u=2;u<r;u++)s[u]=n[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3746:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return c},frontMatter:function(){return o},metadata:function(){return u},toc:function(){return d}});var a=n(7462),i=n(3366),r=(n(7294),n(3905)),s=["components"],o={sidebar_position:6,title:"Blueprint YAML"},l="Blueprints Design",u={unversionedId:"blueprint-designer-guide/blueprints",id:"blueprint-designer-guide/blueprints",title:"Blueprint YAML",description:"Torque's blueprints are reusable components designed to model a required environment from the infrastructure to the application. Blueprint designers utilize Torque's VSCode plugin or the Torque's self-service UI to build a YAML based imperative blueprints that aimed to fulfill business requirements in a self-service manner for their end-users.",source:"@site/docs/blueprint-designer-guide/blueprints.md",sourceDirName:"blueprint-designer-guide",slug:"/blueprint-designer-guide/blueprints",permalink:"/blueprint-designer-guide/blueprints",editUrl:"https://github.com/QualiTorque/torque-docs/tree/master/docs/blueprint-designer-guide/blueprints.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6,title:"Blueprint YAML"},sidebar:"torqueSidebar",previous:{title:"Autogenerated Blueprints",permalink:"/blueprint-designer-guide/Autogenerated Blueprints"},next:{title:"Blueprint Policies",permalink:"/blueprint-designer-guide/Policies"}},p={},d=[{value:"Torque&#39;s Blueprint YAML",id:"torques-blueprint-yaml",level:2},{value:"spec_version",id:"spec_version",level:3},{value:"Description",id:"description",level:3},{value:"Inputs",id:"inputs",level:3},{value:"Outputs",id:"outputs",level:3},{value:"Grains",id:"grains",level:3},{value:"Source",id:"source",level:3},{value:"Host",id:"host",level:3},{value:"Grain inputs &amp; outputs",id:"grain-inputs--outputs",level:3},{value:"Grain dependencies",id:"grain-dependencies",level:3},{value:"Torque Templating engine",id:"torque-templating-engine",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"The Terraform Grain",id:"the-terraform-grain",level:2},{value:"source",id:"source-1",level:3},{value:"host",id:"host-1",level:3},{value:"tf-version",id:"tf-version",level:3},{value:"inputs",id:"inputs-1",level:3},{value:"tags",id:"tags",level:3},{value:"outputs",id:"outputs-1",level:3},{value:"scripts",id:"scripts",level:3},{value:"The HELM Grain",id:"the-helm-grain",level:2},{value:"source",id:"source-2",level:3},{value:"host",id:"host-2",level:3},{value:"inputs",id:"inputs-2",level:3},{value:"commands",id:"commands",level:3},{value:"The CloudFormation Grain\u200b",id:"the-cloudformation-grain",level:2},{value:"source",id:"source-3",level:3},{value:"host",id:"host-3",level:3},{value:"inputs\u200b",id:"inputs-3",level:3},{value:"tags\u200b",id:"tags-1",level:3},{value:"outputs\u200b",id:"outputs-2",level:3},{value:"The Kubernetes Grain\u200b",id:"the-kubernetes-grain",level:2},{value:"source",id:"source-4",level:3},{value:"host",id:"host-4",level:3},{value:"tags\u200b",id:"tags-2",level:3},{value:"namespace",id:"namespace",level:3},{value:"scripts (outputs)",id:"scripts-outputs",level:2}],m={toc:d};function c(e){var t=e.components,n=(0,i.Z)(e,s);return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"blueprints-design"},"Blueprints Design"),(0,r.kt)("p",null,"Torque's blueprints are reusable components designed to model a required environment from the infrastructure to the application. ",(0,r.kt)("strong",{parentName:"p"},"Blueprint designers")," utilize Torque's VSCode plugin or the Torque's self-service UI to build a YAML based imperative blueprints that aimed to fulfill business requirements in a self-service manner for their end-users. "),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),(0,r.kt)("strong",{parentName:"h5"},"Note"))),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Blueprints are written in YAML files that reside in a ",(0,r.kt)("strong",{parentName:"p"},"/blueprints")," folder within a git or BitBucket repository. The ",(0,r.kt)("strong",{parentName:"p"},"/blueprints")," folder must be defined as the blueprint repository in the space's ",(0,r.kt)("strong",{parentName:"p"},"Settings > Repositories")," page. "))),(0,r.kt)("p",null,"Common example will be a platform team or a DevOps team building Dev, Test and staging environments for their development, QA and product teams. With Torque, the DevOps team can focus on design, best practices, and security for environment, while their end users are being self-served from the torque UI, API or eco-system integrations based on governance and policies without having the 'keys-to-the-cloud'."),(0,r.kt)("h2",{id:"torques-blueprint-yaml"},"Torque's Blueprint YAML"),(0,r.kt)("p",null,"The Torque's YAML is a the main specification for blueprint designers to build blueprints out of grains and expose environments to end-users in the Torque's catalog. "),(0,r.kt)("h3",{id:"spec_version"},"spec_version"),(0,r.kt)("p",null,"The spec_version determines the blueprint YAML type. Currently, Torque supports spec_version:2 as the default and recommended version. With time, new preview releases and official feature releases will bring more and more features and users will be able to use other spec versions."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"spec_version: 2\n")),(0,r.kt)("h3",{id:"description"},"Description"),(0,r.kt)("p",null,"The blueprint\u2019s description is an optional but recommended field. Blueprint description will be presented in the Torque's UI and API so users consuming environment will have more information about the blueprints to batter match their business need to the available set of blueprints published in the account catalog."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"spec_version: 2\ndescription: Performance testing deployment based on RDS, EKS and Lambda\n\n")),(0,r.kt)("h3",{id:"inputs"},"Inputs"),(0,r.kt)("p",null,"Blueprint designers can expose blueprint inputs to their end-users to add flexibility while launching a new sandbox from the blueprints - without altering the blueprint code itself. Inputs data can be later used in the blueprint to control orchestration, pass information to automation process and more."),(0,r.kt)("p",null,"Input definition is composed out of the following fields: "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The input name"),(0,r.kt)("li",{parentName:"ul"},"The input description - that will be presented to all users in the Torque UI and API's"),(0,r.kt)("li",{parentName:"ul"},"The input type. Supported types: string."),(0,r.kt)("li",{parentName:"ul"},"Input default value - the value that will be used in the Torque UI and will be used in case no other value provided for the input.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},'inputs:\n  app_version:\n    type: string\n    default: "0.9.9"\n    description: "The version of the application to be deployed on the EKS cluster"\n')),(0,r.kt)("h3",{id:"outputs"},"Outputs"),(0,r.kt)("p",null,"Outputs exposes information about your newly deployed sandbox and make it available for the sandbox consumer or automation processes. Outputs will usually be available at the end of the sandbox initialization and accessible throughout the sandbox lifecycle."),(0,r.kt)("p",null,"Outputs are a dictionary composed by the output name and the output value."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"outputs:\n  WebsiteUrl:\n    value: 'application-name-{{ sandboxid | downcase }}.testquali.click:8080'\n    kind: link\n  DB_Hostname:\n    value: '{{ .grains.mySqlDB.outputs.hostname }}'\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The example above includes some of the Torque's YAML templating engine capabilities allowing the blueprint designer more flexibility and leads to less code that will require maintenance. More examples for templating will be described HERE LINK"))),(0,r.kt)("h3",{id:"grains"},"Grains"),(0,r.kt)("p",null,"Grains are the basic building blocks of a blueprint utilizing infrastructure as code (IaC) assets or automation processes to orchestrate the desired environment. In many organization, the blueprint designers will have a predefined set of grains they can use in blueprints provided by the IT/Ops/DevOps or platform team. "),(0,r.kt)("p",null,"basic grain template is composed out of the grain name, kind, inputs and output. specific grains might support other features that are technology specific."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grain_name:\n    kind: terraform\n    spec:\n      source: \n        path: <path to repository>\n      host:\n        name: '{{ .inputs.host_name }}'\n      inputs:\n        - input1: '{{ .inputs.value1 }}'\n        - input1: '{{ .inputs.value2}}'\n      outputs:\n        - output1\n        - output2\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Note that in auto-generated blueprints, the grain_name.spec.host.name is automatically exposed as a blueprint input for the blueprint designer ease of use. As best practice, it's recommended to remove the host.name from being an input once the blueprint is exposed to the catalog."))),(0,r.kt)("p",null,"The following grains are available:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#the-terraform-grain"},"Terraform")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#the-helm-grain"},"Helm")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#the-cloudformation-grain"},"CloudFormation")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#the-kubernetes-grain"},"Kubernetes"))),(0,r.kt)("h3",{id:"source"},"Source"),(0,r.kt)("p",null,"Sources are repositories storing IaC, CM or other configuration technology that will be utilized by Torque to launch and operate an environment. Torque supports multiple ways to define grain sources.\nSources can be defined in the following ways:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Direct link to a source control folder. Composed from the repository URL followed by the folder structure leading to the folder where IaC code resides. For example:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grains:\n  aurora:\n    kind: terraform\n    spec:\n      source:\n        path: github.com/organization/repository.git//folder1/folder2\n")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"location based on a repository (blueprints or assets) onboarded to Torque. The name of the repository should be provided under the 'store' field, while the IaC code folder location should be specified under the path field. In the below example, nginx helm chart resides in the 'nginx' folder within a repository onboarded to Torque with the name 'web_servers'.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grains:\n  nginx:\n    kind: helm\n    spec:\n      source:\n        store: web_servers\n        path: nginx\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"In case your IaC code is not under folder in the repository, the path should be set as in the following example:"),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"      source:\n        store: web_servers\n        path: .\n")))),(0,r.kt)("h3",{id:"host"},"Host"),(0,r.kt)("p",null,"Hosts, or ",(0,r.kt)("strong",{parentName:"p"},"Execution Hosts")," are the locations where grains will be deployed from. While different grains behave differently, it's important to choose the right execution host for a grain to make sure authentication, networking and  configuration is all set for sandbox consumers use. Different grains in the same blueprint can use different Execution Hosts to allow maximum flexibility during the orchestration processes."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Hosts gives the flexibility of deploying the same blueprints over different cloud accounts and cloud vendors. For example - the same blueprint can be utilized for Azure or GCP simply by exposing the host as blueprint input allowing the user to choose his favorite cloud provider."))),(0,r.kt)("p",null,"The Execution host configuration must include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"name")," - the given name for the kubernetes cluster configured under the cloud account area where the grain will be executed."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"service-account")," - The service-account name configured within the kubernetes cluster that will be used to execute the grain")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grains:\n  # launch an RDS instance using Terraform\n  rds:\n    kind: terraform\n    spec:\n      host:\n        name: eks-ohio\n        service-account: torque-sa\n")),(0,r.kt)("h3",{id:"grain-inputs--outputs"},"Grain inputs & outputs"),(0,r.kt)("p",null,"Inputs and outputs are used both in the blueprint level and in the grains level. Grains can use inputs and outputs to pass data between IaC components, validate information and eventually lead to reducing the amount of IaC components that needs to be maintained by the organization."),(0,r.kt)("p",null,"In the below example, a Terraform deployment generates a connection string to a managed database that can then be utilized by the application itself using the ability to pass output from one grain as a input to the other."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grains:\n  # launch an RDS instance using Terraform\n  rds:\n    kind: terraform\n    spec:\n      ...\n      ...\n      outputs:\n        - connection_string\n\n  my_app_demo:\n    # Launcing k8s based microservices application using HELM\n    kind: helm\n    depends-on: rds\n    ...\n    ...\n      inputs:\n        - connectionString: '{{ .grains.rds.outputs.connection_string }}'\n")),(0,r.kt)("h3",{id:"grain-dependencies"},"Grain dependencies"),(0,r.kt)("p",null,"The need to deploy one IaC component before the other is common and usually required when 3rd party components, managed services and other teams need to provide the infrastructure. Using dependencies in the blueprint YAML Torque will evaluate and optimize the deployment process to make sure dependencies are respected and components with no dependencies will be deployed in parallel to maximize efficiency and reduce overall uptime."),(0,r.kt)("p",null,"In the example below, 3 grain in the bluerpint will be deployed in the following order: rds and redis will be deployed in parallel - and my_app will be deployed next, only in case of a successful deployment."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grains:\n  # launch an RDS instance using Terraform\n  rds:\n    kind: terraform\n\ngrains:\n  # launch an ElastiCache \n  redis:\n    kind: terraform\n\n  my_app_demo:\n    # Launcing k8s based microservices application using HELM\n    kind: helm\n    depends-on: rds, redis\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The ability to use outputs from specific grain usually requires the grain deployment to finish successfully. designing a blueprint with output usually requires dependencies between the grains."))),(0,r.kt)("h3",{id:"torque-templating-engine"},"Torque Templating engine"),(0,r.kt)("p",null,"Templating engines are a great way to enrich the YAML format to allow extensibility points and text manipulations. Torque utilized Shopify's ",(0,r.kt)("a",{parentName:"p",href:"https://shopify.github.io/liquid/"},"liquid")," engine to allow multiple text manipulations in runtime."),(0,r.kt)("p",null,"In the below example the ",(0,r.kt)("a",{parentName:"p",href:"https://shopify.github.io/liquid/filters/downcase/"},"downcase")," and ",(0,r.kt)("a",{parentName:"p",href:"https://shopify.github.io/liquid/filters/strip/"},"strip")," keywords are used with concatenation of the sandbox id to create a new S3 bucket (AWS) using Terraform while making sure the bucket name will be valid and unique."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"  s3_bucket:\n    kind: terraform\n    spec:\n      source:\n        path: s3\n      host:\n        name: '{{ .inputs.host_name }}'\n      inputs:\n        - bucket_name: ''{{ .inputs.bucket_name | strip }}'-bucket-{{ sandboxid | downcase }}'\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Blueprint designers might need extra details about the account, space or sandbox during the sandbox orchestration. Torque provides dynamic attributes such as a sandboxid, accountid and spaceid that can be used through the orchestration and automation process.   "))),(0,r.kt)("h3",{id:"environment-variables"},"Environment Variables"),(0,r.kt)("p",null,"In many cases, passing information through environment variables is required for IaC modules to properly execute with the right data in mind. The environment variables provided under a specific grain will be accessible only during the grain lifecycle of the specific grain and can be used as a specific string or to be derived from a blueprint input or other grain output. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"  s3_bucket:\n    kind: \n    spec:\n    ...\n    ...\n      env-vars:\n      - name: VAR_NAME1\n        value: value1\n      - name: VAR_NAME2\n        value: '{{ .inputs.input_name }}'\n      - name: VAR_NAME3\n        value: '{{ .grains.vm.outputs.host_name }}'\n")),(0,r.kt)("h2",{id:"the-terraform-grain"},"The Terraform Grain"),(0,r.kt)("p",null,"The Terraform grain is Torque's native support for HashiCorp Terraform modules. Torque allows designers to use Terraform specific features to easily orchestrate self-developer and community Terraform modules in a standard way and share them with others as building blocks."),(0,r.kt)("h3",{id:"source-1"},"source"),(0,r.kt)("p",null,"Please see ",(0,r.kt)("a",{parentName:"p",href:"/blueprint-designer-guide/blueprints#source"},"the grain source")," for more details."),(0,r.kt)("h3",{id:"host-1"},"host"),(0,r.kt)("p",null,"Please see ",(0,r.kt)("a",{parentName:"p",href:"/blueprint-designer-guide/blueprints#host"},"the grain host")," for more details."),(0,r.kt)("h3",{id:"tf-version"},"tf-version"),(0,r.kt)("p",null,"Torque provides the flexability to choose a specific Terraform version with which the Terraform module will be deploy."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Note that Torque supports all Terraform versions available by Hashicorp without Alpha and Beta versions.\nList of supported releases can be found ",(0,r.kt)("a",{parentName:"p",href:"https://releases.hashicorp.com/terraform/"},"here")))),(0,r.kt)("h3",{id:"inputs-1"},"inputs"),(0,r.kt)("p",null,"Similar to blueprint inputs, the Terraform grain input allowed to reuse the same Terraform module in different ways. Inputs provided to the Terraform grain will be used when launching the Terraform module. Terraform grain inputs should be listed in the order defined in the module's variables.tf file. We recommend using Torque's auto-discovery capability to quickly model your Terraform modules within Torque including all defined inputs."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grains:\n  database:\n    kind: terraform\n    spec:\n      source:\n        store: infra \n        path: terraform/rds\n      ...\n      inputs:\n        - database_size: '{{ .inputs.db_size }}' \n        - database_name: '{{ .inputs.db_name }}' \n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Note that in the above example, blueprint inputs are used as the values of the Terraform grain inputs, so the sandbox owner is able to choose the db_size and db_name required for his need. The information provided by the user will be passed to Terraform and affect the deployment process"))),(0,r.kt)("h3",{id:"tags"},"tags"),(0,r.kt)("p",null,"Whenever a Terraform grain is launched, all resources created during the deployment process will be automatically tagged with Torque's system tags, blueprint tags and customer tags. if you wish to disable tagging for all resources in a specific Terraform grain, use the following syntax:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grains:\n  database:\n    kind: terraform\n    spec:\n      tags:\n        auto-tag: false\n")),(0,r.kt)("h3",{id:"outputs-1"},"outputs"),(0,r.kt)("p",null,"Output are strings generated by Terraform during the deployment process. Outputs should be defined in the outputs.tf file located in the Terraform module folder. We recommend using Torque's auto-discovery capability to quickly model your Terraform modules within Torque including it's defined outputs."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grains:\n  database:\n    kind: terraform\n    spec:\n      source:\n        path: github.com/org/repo.git//terraform/rds\n      ...\n      outputs:\n        - hostname\n        - connection_string\n")),(0,r.kt)("h3",{id:"scripts"},"scripts"),(0,r.kt)("p",null,"Torque provides the ability to execute custom code before the executing the Terraform module init and before the Terraform destroy process. Scripts allows to run CLI commands to make sure authentication and requirements are set prior to the Terraform execution at the sandbox initialization and destroy process.\nIn the below example, authentication script is used to assume role to another AWS account prior to deploying workload into that account."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grains:\n  amazon_emr:\n    kind: terraform\n    spec:\n    ...\n      source:\n        store: tf-repo\n        path: .\n      scripts: \n        pre-tf-init:\n          source:\n            store: tf-repo\n            path : scripts/authenticate.sh\n          arguments: '{{.inputs.ACCOUNT_ID}}'\n        pre-tf-destroy:\n          source:\n            store: tf-repo\n            path : scripts/authenticate.sh\n          arguments: '{{.inputs.ACCOUNT_ID}}'\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Note that scripts should be stored next to your IaC code to be used under the scripts section."))),(0,r.kt)("h2",{id:"the-helm-grain"},"The HELM Grain"),(0,r.kt)("p",null,"The HELM grain is Torque's native support for HELM v3 charts. Torque allows designers to use HELM specific features to easily orchestrate self-developer and community charts in a standard way and share them with others as building blocks."),(0,r.kt)("h3",{id:"source-2"},"source"),(0,r.kt)("p",null,"Please see ",(0,r.kt)("a",{parentName:"p",href:"/blueprint-designer-guide/blueprints#source"},"the grain source")," for more details."),(0,r.kt)("h3",{id:"host-2"},"host"),(0,r.kt)("p",null,"Please see ",(0,r.kt)("a",{parentName:"p",href:"/blueprint-designer-guide/blueprints#host"},"the grain host")," for more details."),(0,r.kt)("h3",{id:"inputs-2"},"inputs"),(0,r.kt)("p",null,"Similar to blueprint inputs, and Terraform inputs, the HELM grain inputs allowed to reuse the same HELM chart in different ways using different values override. Inputs provided to the HELM grain will be used when launching the HELM chart. We recommend using Torque's auto-discovery capability to quickly model your HELM chart within Torque including all defined inputs."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grains:\n  nginx:\n    kind: helm\n    spec:\n      source:\n        path: https://github.com/bitnami/charts.git//bitnami/nginx\n      host:\n      ...\n      inputs:\n        - replicaCount: '{{ .inputs.replicaCount }}'\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Note that in the above example, blueprint input is used as the value of the HELM grain input, so the sandbox owner is able to choose the replicaCount required for his need. The information provided by the user will be passed to HELM chart as values and affect the deployment process."))),(0,r.kt)("h3",{id:"commands"},"commands"),(0,r.kt)("p",null,"The commands section allows to execute CLI code prior to the HELM chart deployment to make sure all dependencies are met to ensure a successful deployment. Common use for commands is to execute HELM dependencies update to collect all the sub-charts required for the deployment."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grains:\n  nginx:\n    kind: helm\n    spec:\n      source:\n        path: https://github.com/bitnami/charts.git//bitnami/nginx\n      host:\n        name: aws-demo\n      inputs:\n        - replicaCount: '{{ .inputs.replicaCount }}'\n      commands:\n        - dep up bitnami/nginx\n")),(0,r.kt)("h2",{id:"the-cloudformation-grain"},"The CloudFormation Grain\u200b"),(0,r.kt)("p",null,"The CloudFormation grain is Torque's native support for AWS CloudFormation templates. Torque allows designers to use CloudFormation features to easily orchestrate self-developer and community CloudFormation modules in a standard way and share them with others as building blocks."),(0,r.kt)("h3",{id:"source-3"},"source"),(0,r.kt)("p",null,"Please see ",(0,r.kt)("a",{parentName:"p",href:"/blueprint-designer-guide/blueprints#source"},"the grain source")," for more details."),(0,r.kt)("h3",{id:"host-3"},"host"),(0,r.kt)("p",null,"Please see ",(0,r.kt)("a",{parentName:"p",href:"/blueprint-designer-guide/blueprints#host"},"the grain host")," for more details."),(0,r.kt)("h3",{id:"inputs-3"},"inputs\u200b"),(0,r.kt)("p",null,"Similar to blueprint inputs, CloudFormation grain inputs allow you to reuse the same CloudFormation module in different ways. Inputs provided to the CloudFormation grain are used when launching the CloudFormation module. CloudFormation grain inputs should be listed in the order defined in the module's ",(0,r.kt)("em",{parentName:"p"},"variables.tf")," file."),(0,r.kt)("h3",{id:"tags-1"},"tags\u200b"),(0,r.kt)("p",null,"Whenever a CloudFormation grain is launched, all resources created during the deployment process are automatically tagged with Torque's system tags, blueprint tags and customer tags."),(0,r.kt)("h3",{id:"outputs-2"},"outputs\u200b"),(0,r.kt)("p",null,"Outputs are strings generated by CloudFormation during the deployment process."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grains:\n  database:\n    kind: cloudformation\n    spec:\n      source:\n        path: github.com/org/repo.git//terraform/rds\n        ...\n      outputs:\n        - hostname\n        - connection_string\n")),(0,r.kt)("h2",{id:"the-kubernetes-grain"},"The Kubernetes Grain\u200b"),(0,r.kt)("p",null,"The Kubernetes grain allows you to use native Kubernetes manifests, manifest catalogs in a given user's repository. Currently, the solution has restriction: it is not possible to launch concurrent sandboxes with Kubernetes grain (because the manifest resources are static and their names are not unique).\nThe deployment namespace must exist in the cluster prior to the deployment. It must not be equal to the namespaces used by Torque for agent deployments."),(0,r.kt)("h3",{id:"source-4"},"source"),(0,r.kt)("p",null,"Please see ",(0,r.kt)("a",{parentName:"p",href:"/blueprint-designer-guide/blueprints#source"},"the grain source")," for more details."),(0,r.kt)("h3",{id:"host-4"},"host"),(0,r.kt)("p",null,"Please see ",(0,r.kt)("a",{parentName:"p",href:"/blueprint-designer-guide/blueprints#host"},"the grain host")," for more details."),(0,r.kt)("h3",{id:"tags-2"},"tags\u200b"),(0,r.kt)("p",null,"Whenever a Kubernetes grain is launched, all resources created during the deployment process are automatically tagged with Torque's system tags, blueprint tags and customer tags. if you wish to disable tagging for all resources in a specific Kubernetes grain, use the following syntax:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grains:\n  database:\n    kind: kubernetes\n    spec:\n      tags:\n        auto-tag: false\n")),(0,r.kt)("h3",{id:"namespace"},"namespace"),(0,r.kt)("p",null,"The deployment namespace must exist in the cluster prior to the deployment. It must not be equal to the namespaces used by Torque for agent deployments."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"grains:\n  web-client:\n    kind: kubernetes\n    spec:\n      sources:\n        ...\n      namespace: '{{ .inputs.namespace }}'\n")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),(0,r.kt)("strong",{parentName:"h5"},"Note"),":")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"Launching concurrent sandboxes with Kubernetes grain is not supported for the same namespace. "),(0,r.kt)("li",{parentName:"ul"},"Make sure the Torque execution host has permissions to use those namespaces.")))),(0,r.kt)("h2",{id:"scripts-outputs"},"scripts (outputs)"),(0,r.kt)("p",null,"Due to Kubernetes deployment limitations, outputs need to be generated from a script and provided as part of the grain.\nThe script is defined in the blueprint and exetued after the grain's installation."),(0,r.kt)("p",null,"For example, script named ",(0,r.kt)("strong",{parentName:"p"},"post-install-script.sh")," that generates two outputs:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:'language-yaml"'},"outputs:\n  output1:\n    kind: regular\n    value: '{{.grains.nginx.scripts.post-kubernetes-install.outputs.output1}}'\n  output2:\n    kind: regular\n    value: '{{.grains.nginx.scripts.post-kubernetes-install.outputs.output2}}'\n\ngrains:\n  nginx:\n    kind: kubernetes\n    spec:\n      source:\n        ...\n      namespace:\n      host:\n        ...\n      scripts:\n        post-kubernetes-install:\n          source:\n            store: Torque-Spec2-Demos\n            path: scripts/post-install-script.sh\n          outputs:\n            - output1\n            - output2\n")))}c.isMDXComponent=!0}}]);