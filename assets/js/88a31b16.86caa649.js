"use strict";(self.webpackChunktorque=self.webpackChunktorque||[]).push([[5807],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>v});var i=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=i.createContext({}),p=function(e){var n=i.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},u=function(e){var n=p(e.components);return i.createElement(o.Provider,{value:n},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},d=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,o=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(t),d=r,v=c["".concat(o,".").concat(d)]||c[d]||m[d]||a;return t?i.createElement(v,s(s({ref:n},u),{},{components:t})):i.createElement(v,s({ref:n},u))}));function v(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,s=new Array(a);s[0]=d;var l={};for(var o in n)hasOwnProperty.call(n,o)&&(l[o]=n[o]);l.originalType=e,l[c]="string"==typeof e?e:r,s[1]=l;for(var p=2;p<a;p++)s[p]=t[p];return i.createElement.apply(null,s)}return i.createElement.apply(null,t)}d.displayName="MDXCreateElement"},2376:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>o,default:()=>v,frontMatter:()=>l,metadata:()=>p,toc:()=>c});var i=t(7462),r=(t(7294),t(3905));const a=t.p+"assets/images/env-pub-usage-f1f90a8751e265b1389bb82983d52608.png",s=t.p+"assets/images/env-pub-blueprint-aa2a3cbe1db6f64a3bded04a2d68fb01.png",l={sidebar_position:17,title:"Environment Publishing"},o=void 0,p={unversionedId:"environment-services/environment-publishing",id:"environment-services/environment-publishing",title:"Environment Publishing",description:"Overview",source:"@site/docs/environment-services/environment-publishing.md",sourceDirName:"environment-services",slug:"/environment-services/environment-publishing",permalink:"/environment-services/environment-publishing",editUrl:"https://github.com/QualiTorque/torque-docs/tree/master/docs/environment-services/environment-publishing.md",tags:[],version:"current",sidebarPosition:17,frontMatter:{sidebar_position:17,title:"Environment Publishing"},sidebar:"torqueSidebar",previous:{title:"Environment Labels",permalink:"/environment-services/environment-labels"},next:{title:"Scheduled Environments",permalink:"/environment-services/scheduled-environments"}},u={},c=[{value:"Overview",id:"overview",level:2},{value:"Concept",id:"concept",level:2},{value:"Key Concepts",id:"key-concepts",level:3},{value:"Usage",id:"usage",level:2},{value:"Publishing an Environment",id:"publishing-an-environment",level:3},{value:"Unpublishing an Environment",id:"unpublishing-an-environment",level:3},{value:"Referencing Published Environments",id:"referencing-published-environments",level:2},{value:"Blueprint example",id:"blueprint-example",level:3},{value:"API Support",id:"api-support",level:2},{value:"System Label for Published State",id:"system-label-for-published-state",level:2},{value:"Handling Visibility in Spaces",id:"handling-visibility-in-spaces",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"API Reference",id:"api-reference",level:2}],m={toc:c},d="wrapper";function v(e){let{components:n,...t}=e;return(0,r.kt)(d,(0,i.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"The Environment Publishing feature provides infrastructure teams with the capability to share environments across projects or spaces that possess distinct lifecycles. This functionality facilitates the seamless dissemination of environments for consumption by other environments, thereby optimizing resource utilization and enhancing dependency management."),(0,r.kt)("h2",{id:"concept"},"Concept"),(0,r.kt)("p",null,'Environment Publishing establishes a mechanism to designate an environment as "published," thereby rendering it accessible for reuse across different spaces or within the same space. Published environments can function as foundational inputs for the deployment of other environments, thus promoting a cohesive integration among interdependent environments.'),(0,r.kt)("h3",{id:"key-concepts"},"Key Concepts"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Lifecycle Management"),": While published environments retain independent lifecycle governance, they remain accessible as inputs for use in other environments, supporting a structured approach to lifecycle dependencies."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Publishing State"),': Environments can be toggled between "published" and "unpublished" states, indicating their availability for cross-space consumption.'),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Visibility Control"),": The scope of visibility for a published environment can be explicitly defined to include either all spaces or a subset of specified spaces."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Blueprint Design"),": Blueprints may declare references to published environments, facilitating the integration of shared resources during environment instantiation."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Environment Reuse"),": Published environments are referenceable and reusable across multiple environments, thereby mitigating redundancy and reducing complexities in dependency management.")),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("h3",{id:"publishing-an-environment"},"Publishing an Environment"),(0,r.kt)("p",null,"To publish an environment:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Utilize the API or the user interface (UI) to designate an environment as published."),(0,r.kt)("li",{parentName:"ol"},"Configure the accessibility scope:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"All Spaces"),": Grants access to the environment across all spaces within the account."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Specific Spaces"),": Restricts access solely to the designated spaces."))),(0,r.kt)("li",{parentName:"ol"},"Optionally, rename the environment to ensure uniqueness across all published environments. While uniqueness is not strictly mandated, it is considered a best practice to avoid naming collisions."),(0,r.kt)("li",{parentName:"ol"},'Ensure that the environment is in either the "Active" or "Updating" state before publishing, as only environments in these states can be published.')),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"When an environment is published, it is automatically available within its source space. Additional spaces may be specified as required."))),(0,r.kt)("blockquote",null,(0,r.kt)("img",{src:a,alt:"env-pub-usage",style:{width:400}})),(0,r.kt)("h3",{id:"unpublishing-an-environment"},"Unpublishing an Environment"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Utilize the dedicated API or UI to unpublish an environment."),(0,r.kt)("li",{parentName:"ul"},"If the environment maintains active connections to other environments, a warning will be issued; however, the unpublishing operation will still proceed."),(0,r.kt)("li",{parentName:"ul"},"Environments are automatically unpublished upon their termination.")),(0,r.kt)("h2",{id:"referencing-published-environments"},"Referencing Published Environments"),(0,r.kt)("p",null,"Published environments may be employed as inputs within blueprints through the definition of environment references in the blueprint YAML. Such references allow the consuming environment to dynamically establish links to the published environment."),(0,r.kt)("p",null,'Optionally, the environment reference may include label-based filters to restrict selection to environments meeting specific criteria (e.g., specifying a "cluster" label to select a Kubernetes cluster).'),(0,r.kt)("blockquote",null,(0,r.kt)("img",{src:s,alt:"env-pub-blueprint",style:{width:700}})),(0,r.kt)("h3",{id:"blueprint-example"},"Blueprint example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"spec_version: 2\n\ndescription: |\n  'Provisions a web server on EC2 instance using provided inputs, such as operating system, application version, etc. \n  The instance serves dynamic content reflecting the specified inputs.'\n\nenv_references:\n  VPC:\n    labels-selector: 'VPC'\n\ninputs:\n  Region:\n    type: 'string'\n    allowed-values:\n      - 'eu-west-1'\n      - 'eu-central-1'\n      - 'us-east-1'\n    description: 'The name of the AWS Region to use'\n  VM Name:\n    type: 'string'\n    default: 'Webapp'\n    pattern: '^[a-zA-Z0-9._-]{1,256}$'\n    validation-description: 'VM name must have between 1 and 256 alphanumeric characters, hypens, underscores and dashes only.'\n    description: 'The name of the underlying EC2 instance in AWS'\n  Size:\n    type: 'parameter'\n    parameter-name: 'size'\n    description: 'The EC2 instance type'\n  OS:\n    type: 'string'\n    allowed-values:\n      - 'Windows Server 2016'\n      - 'RHEL 7'\n      - 'RHEL 8'\n      - 'RHEL 9'\n      - 'Ubuntu 20.04'\n      - 'Ubuntu 22.04'\n    description: 'The type of operating system and corresponding AMI to use in the EC2 instance'\n  Version:\n    depends-on: 'OS'\n    type: 'input-source'\n    source-name: 's3'\n    overrides:\n      - json_path: '$.{{ .inputs.OS | split: \" \" | first % }}[*]'\n    description: 'Application Version'\noutputs:\n  Address:\n    value: 'https://{{ .grains.webapp.outputs.instance_public_ip}}'\n    quick: true\n  VPC_ID:\n    value: '{{ .env_references.VPC.outputs.vpc_id }}'\n\ngrains:\n  webapp:\n    kind: 'terraform'\n    spec:\n      source:\n        store: 'infra-portal'\n        path: 'assets/terraform/aws/webapp'\n      agent:\n        name: 'demo-prod'\n        service-account: 'app-sa'\n      inputs:\n        - vpc: '{{ .env_references.VPC.outputs.vpc_id }}'\n        - region: '{{ .inputs.Region }}'\n        - size: '{{ .inputs.Size }}'\n        - name: '{{ .inputs.[\"VM Name\"] }}'\n        - os: '{{ .inputs.OS }}'\n        - app_version: '{{ .inputs.Version }}'\n        - env_id: '{{ envId | downcase }}'\n      outputs:\n        - 'instance_public_ip'\n")),(0,r.kt)("h2",{id:"api-support"},"API Support"),(0,r.kt)("p",null,"A range of APIs is available to support the following operations:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Retrieval, publication, unpublication, and update of publishing details."),(0,r.kt)("li",{parentName:"ul"},"Validation of environment name uniqueness among published environments."),(0,r.kt)("li",{parentName:"ul"},"Filtering of environments based on their publishing state."),(0,r.kt)("li",{parentName:"ul"},"Retrieval of outputs from published environments for reference.")),(0,r.kt)("h2",{id:"system-label-for-published-state"},"System Label for Published State"),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"Published")," property is available as a system label, facilitating the filtering and tracking of published environments."),(0,r.kt)("h2",{id:"handling-visibility-in-spaces"},"Handling Visibility in Spaces"),(0,r.kt)("p",null,"Environments are implicitly published within their originating space, with additional spaces optionally specified for broader visibility."),(0,r.kt)("p",null,"UI and API-based validations mitigate the risks of publishing conflicts and issue warnings in the event of potential naming collisions."),(0,r.kt)("h2",{id:"best-practices"},"Best Practices"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Unique Naming"),": Assign unique names to published environments to prevent conflicts and enhance clarity in resource identification."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Use Labels"),": Utilize labels to categorize environments effectively, thereby enabling dynamic selection during blueprint execution."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Regular Cleanup"),": Unpublish environments that are no longer active or required to minimize clutter and maintain efficient resource management.")),(0,r.kt)("h2",{id:"api-reference"},"API Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Publish Environment"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"POST /environments/{id}/publish")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Unpublish Environment"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"POST /environments/{id}/unpublish")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Get Published Environments"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"GET /environments?filter=isPublished:true")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Update Publishing Info"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"PATCH /environments/{id}/publish-info")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Retrieve Outputs"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"GET /environments/{id}/outputs"))))}v.isMDXComponent=!0}}]);