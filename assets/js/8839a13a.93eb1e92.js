"use strict";(self.webpackChunktorque=self.webpackChunktorque||[]).push([[3032],{3905:(e,n,t)=>{t.d(n,{Zo:()=>l,kt:()=>b});var r=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var u=r.createContext({}),p=function(e){var n=r.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},l=function(e){var n=p(e.components);return r.createElement(u.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},h=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,a=e.originalType,u=e.parentName,l=o(e,["components","mdxType","originalType","parentName"]),c=p(t),h=i,b=c["".concat(u,".").concat(h)]||c[h]||d[h]||a;return t?r.createElement(b,s(s({ref:n},l),{},{components:t})):r.createElement(b,s({ref:n},l))}));function b(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=t.length,s=new Array(a);s[0]=h;var o={};for(var u in n)hasOwnProperty.call(n,u)&&(o[u]=n[u]);o.originalType=e,o[c]="string"==typeof e?e:i,s[1]=o;for(var p=2;p<a;p++)s[p]=t[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}h.displayName="MDXCreateElement"},2643:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>o,toc:()=>p});var r=t(7462),i=(t(7294),t(3905));const a={sidebar_position:30,title:"The Blueprint Grain"},s=void 0,o={unversionedId:"blueprint-designer-guide/blueprints/blueprint-grain",id:"blueprint-designer-guide/blueprints/blueprint-grain",title:"The Blueprint Grain",description:'The Blueprint grain is Torque\u2019s built-in support for allowing a Torque blueprint to be used as a grain in another Torque blueprint. This process is called "nesting" and such a blueprint will then be referred to as a "nested blueprint" within the context of the blueprint in which it is used as a grain. The blueprint containing the blueprint grain is called the \u201cnesting blueprint\u201d.',source:"@site/docs/blueprint-designer-guide/blueprints/blueprint-grain.md",sourceDirName:"blueprint-designer-guide/blueprints",slug:"/blueprint-designer-guide/blueprints/blueprint-grain",permalink:"/blueprint-designer-guide/blueprints/blueprint-grain",editUrl:"https://github.com/QualiTorque/torque-docs/tree/master/docs/blueprint-designer-guide/blueprints/blueprint-grain.md",tags:[],version:"current",sidebarPosition:30,frontMatter:{sidebar_position:30,title:"The Blueprint Grain"},sidebar:"torqueSidebar",previous:{title:"The CloudShell Grain",permalink:"/blueprint-designer-guide/blueprints/cloudshell-grain"},next:{title:"The layout yaml",permalink:"/blueprint-designer-guide/layouts/"}},u={},p=[{value:"source",id:"source",level:3},{value:"agent",id:"agent",level:3},{value:"inputs",id:"inputs",level:3},{value:"outputs",id:"outputs",level:3}],l={toc:p},c="wrapper";function d(e){let{components:n,...t}=e;return(0,i.kt)(c,(0,r.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,'The Blueprint grain is Torque\u2019s built-in support for allowing a Torque blueprint to be used as a grain in another Torque blueprint. This process is called "nesting" and such a blueprint will then be referred to as a "nested blueprint" within the context of the blueprint in which it is used as a grain. The blueprint containing the blueprint grain is called the \u201cnesting blueprint\u201d. '),(0,i.kt)("p",null,"Nesting a blueprint allows you to carry over (in a single grain) all of the nested blueprint\u2019s grains, internal dependencies, and orchestration relationships, while only needing to provide the inputs for the nested blueprint, and specify the outputs expected to be received from it. These outputs can then be referred to by other grains in the blueprint. "),(0,i.kt)("p",null,"Note that the grain name of the blueprint grain ",(0,i.kt)("strong",{parentName:"p"},"must exactly match")," the name of an existing blueprint within the Torque repository referenced in the \u201csource: \u2014> store:\u201d attribute. This is the way the grain specifies which blueprint to use."),(0,i.kt)("h3",{id:"source"},"source"),(0,i.kt)("p",null,"The source section of a blueprint grain must contain the ",(0,i.kt)("inlineCode",{parentName:"p"},"store:")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"path:")," attributes. ",(0,i.kt)("inlineCode",{parentName:"p"},"store:")," defines the name of the git repository containing the blueprint, and ",(0,i.kt)("inlineCode",{parentName:"p"},"path:"),' is set to "blueprints", which is the mandatory name for the blueprints folder in a Torque blueprints repository. '),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"grains:\n  nginx:\n    kind: blueprint\n    spec:\n      source:\n        store: <space's blueprint repository>\n        path: blueprints      \n")),(0,i.kt)("p",null,"Please see ",(0,i.kt)("a",{parentName:"p",href:"/blueprint-designer-guide/blueprints/blueprints-yaml-structure#source"},"the grain source")," for more details."),(0,i.kt)("h3",{id:"agent"},"agent"),(0,i.kt)("p",null,"The blueprint grain does not require an agent as Torque uses the agent defined in the referenced blueprint. However, you can specify the agent as an input of ",(0,i.kt)("inlineCode",{parentName:"p"},"type: agent")," on the blueprint level, and reference it from the grain, both as an input and in the host section."),(0,i.kt)("h3",{id:"inputs"},"inputs"),(0,i.kt)("p",null,"Blueprint grain inputs are the names of the inputs of the nested blueprint, and the values being provided for each one when the blueprint is launched as a nested blueprint. These names must exactly match the input names in the ",(0,i.kt)("inlineCode",{parentName:"p"},"inputs:")," section of the nested blueprint\u2019s blueprint YAML."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Example:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"grains:\n  nginx:\n    kind: blueprint\n    spec:\n      source:\n        ...\n      inputs:\n        - instance_id: '{{ .inputs.instance_id }}'\n        - application_port: '{{ .inputs.application_port }}'\n")),(0,i.kt)("h3",{id:"outputs"},"outputs"),(0,i.kt)("p",null,"Blueprint grain outputs are the names of the outputs of the nested blueprint, which will determine which outputs will be populated on the blueprint grain to be later referenced by other grains or by the nesting blueprint\u2019s ",(0,i.kt)("inlineCode",{parentName:"p"},"outputs")," section. These names must exactly match the input names in the ",(0,i.kt)("inlineCode",{parentName:"p"},"outputs:")," section of the nested blueprint\u2019s blueprint YAML."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Example:")," Below is an example of a grains section of a nesting blueprint, containing a blueprint grain and a helm grain that depends on it:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"grains:\n  infra:\n    kind: blueprint\n    spec:\n      source: \n        store: Assets\n        path: blueprints\n      inputs:\n        - size: '{{ .inputs.db_size }}'\n        - engine_version: '{{ .inputs.db_engine_version }}'\n      outputs:\n        - DB_hostname\n        - connection_string\n        - S3_bucket_arn\n\n  K8sMicroservicesApp:\n    kind: helm\n    depends-on: infra\n    spec:\n      source:\n        store: Assets\n        path: assets/myHelmApp\n      agent:\n        name: my-torque-agent\n      inputs:\n        - hostname: 'myApp-{{ sandboxid | downcase }}'\n        - domain: 'torque-demo.click'\n        - version: '{{ .inputs.version }}'\n        - connectionString: '{{ .grains.infra.outputs.connection_string }}'\n        - objectStore.s3BucketArn: '{{ .grains.infra.outputs.S3_bucket_arn }}'\n        - redis.storageClassName: gp2\n\n")))}d.isMDXComponent=!0}}]);