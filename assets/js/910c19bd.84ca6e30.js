"use strict";(self.webpackChunktorque=self.webpackChunktorque||[]).push([[1306],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>g});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),u=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},p=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(r),m=a,g=c["".concat(l,".").concat(m)]||c[m]||d[m]||i;return r?n.createElement(g,o(o({ref:t},p),{},{components:r})):n.createElement(g,o({ref:t},p))}));function g(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,o=new Array(i);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:a,o[1]=s;for(var u=2;u<i;u++)o[u]=r[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},9062:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var n=r(7462),a=(r(7294),r(3905));const i={sidebar_position:15,title:"The Terragrunt Grain"},o="The Terragrunt Grain",s={unversionedId:"blueprint-designer-guide/blueprints/terragrunt-grain",id:"blueprint-designer-guide/blueprints/terragrunt-grain",title:"The Terragrunt Grain",description:"The Terragrunt grain is Torque's native support for Terragrunt modules. Terragrunt is a thin wrapper for Terraform that provides extra tools for working with multiple Terraform modules and keeping your configurations DRY. Torque allows designers to use Terragrunt-specific features to easily orchestrate self-developed and community Terragrunt modules in a standard way and share them as building blocks.",source:"@site/docs/blueprint-designer-guide/blueprints/terragrunt-grain.md",sourceDirName:"blueprint-designer-guide/blueprints",slug:"/blueprint-designer-guide/blueprints/terragrunt-grain",permalink:"/blueprint-designer-guide/blueprints/terragrunt-grain",editUrl:"https://github.com/QualiTorque/torque-docs/tree/master/docs/blueprint-designer-guide/blueprints/terragrunt-grain.md",tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15,title:"The Terragrunt Grain"},sidebar:"torqueSidebar",previous:{title:"The Terraform Grain",permalink:"/blueprint-designer-guide/blueprints/terraform-grain"},next:{title:"Custom Grain",permalink:"/blueprint-designer-guide/blueprints/custom-grain"}},l={},u=[{value:"Tools and technologies",id:"tools-and-technologies",level:2},{value:"Grain Spec Reference",id:"grain-spec-reference",level:2},{value:"<code>source</code>",id:"source",level:3},{value:"<code>agent</code>",id:"agent",level:3},{value:"<code>inputs</code>",id:"inputs",level:3},{value:"<code>outputs</code>",id:"outputs",level:3},{value:"<code>tf-version</code>",id:"tf-version",level:3},{value:"<code>env-vars</code>",id:"env-vars",level:3},{value:"<code>scripts</code>",id:"scripts",level:3},{value:"<code>auto-approve</code>",id:"auto-approve",level:3},{value:"Usage Example",id:"usage-example",level:2},{value:"Best Practices and Notes",id:"best-practices-and-notes",level:2}],p={toc:u},c="wrapper";function d(e){let{components:t,...r}=e;return(0,a.kt)(c,(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"the-terragrunt-grain"},"The Terragrunt Grain"),(0,a.kt)("p",null,"The Terragrunt grain is Torque's native support for ",(0,a.kt)("a",{parentName:"p",href:"https://terragrunt.gruntwork.io/"},"Terragrunt")," modules. Terragrunt is a thin wrapper for Terraform that provides extra tools for working with multiple Terraform modules and keeping your configurations DRY. Torque allows designers to use Terragrunt-specific features to easily orchestrate self-developed and community Terragrunt modules in a standard way and share them as building blocks."),(0,a.kt)("h2",{id:"tools-and-technologies"},"Tools and technologies"),(0,a.kt)("p",null,"The following tools and technologies are installed out of the box on our agents in the Kubernetes pods and can be used when writing Terragrunt grain scripts (pre/post, etc.):"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"terragrunt"),(0,a.kt)("li",{parentName:"ul"},"terraform"),(0,a.kt)("li",{parentName:"ul"},"git"),(0,a.kt)("li",{parentName:"ul"},"python3"),(0,a.kt)("li",{parentName:"ul"},"pip3"),(0,a.kt)("li",{parentName:"ul"},"jq"),(0,a.kt)("li",{parentName:"ul"},"docker-compose"),(0,a.kt)("li",{parentName:"ul"},"curl"),(0,a.kt)("li",{parentName:"ul"},"awscli"),(0,a.kt)("li",{parentName:"ul"},"kubectl"),(0,a.kt)("li",{parentName:"ul"},"helm"),(0,a.kt)("li",{parentName:"ul"},"opa")),(0,a.kt)("h2",{id:"grain-spec-reference"},"Grain Spec Reference"),(0,a.kt)("h3",{id:"source"},(0,a.kt)("inlineCode",{parentName:"h3"},"source")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"source")," block specifies the location of the Terragrunt module. The ",(0,a.kt)("inlineCode",{parentName:"p"},"path")," field should point to the root directory of the Terragrunt module, and the ",(0,a.kt)("inlineCode",{parentName:"p"},"store")," field should reference the repository or storage location where the module is stored."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"grains:\n  terragrunt-grain:\n    kind: terragrunt\n    spec:\n      source:\n        path: terragrunt/s3-bucket/non-prod/us-east-1/qa/bucket\n        store: my_repository\n")),(0,a.kt)("h3",{id:"agent"},(0,a.kt)("inlineCode",{parentName:"h3"},"agent")),(0,a.kt)("p",null,"Please see ",(0,a.kt)("a",{parentName:"p",href:"/blueprint-designer-guide/blueprints/blueprints-yaml-structure#agent"},"the grain agent")," for more details. The agent block specifies the agent to use for executing the Terragrunt module. You can reference an input to dynamically specify the agent."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"agent:\n  name: '{{ .inputs.agent }}'\n")),(0,a.kt)("h3",{id:"inputs"},(0,a.kt)("inlineCode",{parentName:"h3"},"inputs")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"inputs")," block is a list of input values to pass to the Terragrunt module. You can reference blueprint inputs or use static values. Inputs are passed as variables to the underlying Terraform modules managed by Terragrunt."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"inputs:\n  - name: '{{ .inputs.bucket_name }}'\n  - region: 'us-east-1'\n")),(0,a.kt)("h3",{id:"outputs"},(0,a.kt)("inlineCode",{parentName:"h3"},"outputs")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"outputs")," block is a list of output values to capture from the Terragrunt module. These outputs can be referenced in other grains or in the blueprint outputs."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"outputs:\n  - bucket_arn\n")),(0,a.kt)("h3",{id:"tf-version"},(0,a.kt)("inlineCode",{parentName:"h3"},"tf-version")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"tf-version")," field is optional and allows you to specify the Terraform version to use for this Terragrunt module. If not specified, the latest compatible version will be used."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"tf-version: 1.5.5\n")),(0,a.kt)("h3",{id:"env-vars"},(0,a.kt)("inlineCode",{parentName:"h3"},"env-vars")),(0,a.kt)("p",null,"Environment variables declared in the Terragrunt grain will be available during both deployment and destroy phases."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"env-vars:\n  - AWS_PROFILE: my-profile\n  - CUSTOM_TOKEN: '{{ .params.token }}'\n")),(0,a.kt)("h3",{id:"scripts"},(0,a.kt)("inlineCode",{parentName:"h3"},"scripts")),(0,a.kt)("p",null,"Torque provides the ability to execute custom scripts before or after Terragrunt commands. The available script hooks are:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"pre-tf-init: Runs before ",(0,a.kt)("inlineCode",{parentName:"li"},"terragrunt init")),(0,a.kt)("li",{parentName:"ul"},"post-tf-plan: Runs after ",(0,a.kt)("inlineCode",{parentName:"li"},"terragrunt plan")),(0,a.kt)("li",{parentName:"ul"},"pre-tf-destroy: Runs before ",(0,a.kt)("inlineCode",{parentName:"li"},"terragrunt destroy"))),(0,a.kt)("p",null,"Example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"scripts:\n  pre-tf-init:\n    source:\n      store: scripts-repo\n      path: scripts/authenticate.sh\n    arguments: '{{ .inputs.ACCOUNT_ID }}'\n")),(0,a.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"Scripts should be stored next to your IaC code to be used under the scripts section."))),(0,a.kt)("h3",{id:"auto-approve"},(0,a.kt)("inlineCode",{parentName:"h3"},"auto-approve")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"auto-approve")," flag is used to automatically approve and apply changes without requiring manual confirmation. By default, Torque will apply the Terragrunt module with auto-approval. To require manual approval, set ",(0,a.kt)("inlineCode",{parentName:"p"},"auto-approve: false"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"auto-approve: false\n")),(0,a.kt)("h2",{id:"usage-example"},"Usage Example"),(0,a.kt)("p",null,"Below is a complete example of a Torque blueprint using a Terragrunt grain:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"spec_version: 2\ndescription: Example blueprint using Terragrunt grain\n\ninputs:\n  agent:\n    type: agent\n  bucket_name:\n    type: string\n\noutputs:\n  bucket_arn:\n    value: '{{ .grains.terragrunt-grain.outputs.bucket_arn }}'\n    kind: string\n\ngrains:\n  terragrunt-grain:\n    kind: terragrunt\n    tf-version: 1.5.5\n    spec:\n      auto-approve: true\n      source:\n        path: terragrunt/s3-bucket/non-prod/us-east-1/qa/bucket\n        store: my_repository\n      agent:\n        name: '{{ .inputs.agent }}'\n      inputs:\n        - name: '{{ .inputs.bucket_name }}'\n      outputs:\n        - bucket_arn\n      env-vars:\n        - AWS_PROFILE: my-profile\n      scripts:\n        pre-tf-init:\n          source:\n            store: scripts-repo\n            path: scripts/authenticate.sh\n          arguments: '{{ .inputs.agent }}'\n\n")),(0,a.kt)("h2",{id:"best-practices-and-notes"},"Best Practices and Notes"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Use blueprint inputs to make your Terragrunt modules reusable and dynamic."),(0,a.kt)("li",{parentName:"ul"},"Outputs from Terragrunt grains can be referenced in other grains or blueprint outputs."),(0,a.kt)("li",{parentName:"ul"},"Use scripts to handle authentication or custom logic before/after Terragrunt commands."),(0,a.kt)("li",{parentName:"ul"},"Always validate and adjust the generated blueprint YAML before running it, especially the outputs section, to ensure it behaves as expected.")),(0,a.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"For more information on Terragrunt, see the ",(0,a.kt)("a",{parentName:"p",href:"https://terragrunt.gruntwork.io/docs/"},"official documentation"),"."))))}d.isMDXComponent=!0}}]);