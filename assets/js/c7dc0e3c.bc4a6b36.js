"use strict";(self.webpackChunktorque=self.webpackChunktorque||[]).push([["2546"],{9046:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>s,toc:()=>u,default:()=>c,metadata:()=>i,assets:()=>l,contentTitle:()=>a});var i=JSON.parse('{"id":"blueprint-designer-guide/blueprint-quickstart-guide","title":"Blueprint Design","description":"What is a Torque blueprint?","source":"@site/docs/blueprint-designer-guide/blueprint-quickstart-guide.md","sourceDirName":"blueprint-designer-guide","slug":"/blueprint-designer-guide/blueprint-quickstart-guide","permalink":"/blueprint-designer-guide/blueprint-quickstart-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/QualiTorque/torque-docs/tree/master/docs/blueprint-designer-guide/blueprint-quickstart-guide.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Blueprint Design"},"sidebar":"defaultSidebar","previous":{"title":"Cross Account Provisioning (AWS)","permalink":"/example-blueprints/Cross Account Provisioning"},"next":{"title":"Blueprint YAML Overview","permalink":"/blueprint-designer-guide/blueprints/blueprints-overview"}}'),r=t(4848),o=t(4429);let s={sidebar_position:1,title:"Blueprint Design"},a=void 0,l={},u=[{value:"What is a Torque blueprint?",id:"what-is-a-torque-blueprint",level:2},{value:"Option A: Let Torque generate blueprints from your assets",id:"option-a-let-torque-generate-blueprints-from-your-assets",level:2},{value:"Option B: Create a multi-asset blueprint in your source control repository",id:"option-b-create-a-multi-asset-blueprint-in-your-source-control-repository",level:2},{value:"Removing a blueprint",id:"removing-a-blueprint",level:2},{value:"Example multi-grain blueprint 1: Helm Application with MySQL and S3 Deployed by Terraform",id:"example-multi-grain-blueprint-1-helm-application-with-mysql-and-s3-deployed-by-terraform",level:2},{value:"Example multi-grain blueprint 2: Web-game on S3 (using CloudFormation and Terraform)",id:"example-multi-grain-blueprint-2-web-game-on-s3-using-cloudformation-and-terraform",level:2}];function d(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"what-is-a-torque-blueprint",children:"What is a Torque blueprint?"}),"\n",(0,r.jsx)(n.p,{children:'A blueprint is a template for provisioning an environment that contains references to different IaC Components ("Grains") that together define the applications, cloud infrastructure, networking and policies that make up a specific environment to be deployed. Blueprints are stored as source-controlled YAML files, and each grain in a blueprint is a reference to one IaC or automation file (for example, a Terraform module or a Helm chart) that will be deployed as part of the environment, and the component\'s designated inputs, outputs and execution information.'}),"\n",(0,r.jsx)(n.p,{children:"A blueprint also contains the orchestration between the grains (provisioning order and dependencies, shared parameter storage, environment duration policies, tag values, etc.), and when launched, deploys a whole environment, from the infrastructure layer to the application itself."}),"\n",(0,r.jsx)(n.p,{children:"You can have Torque discover (i.e. generate) blueprints out of your existing Terraform, Helm, CloudFormation, or other supported IaC assets, or you can develop more sophisticated blueprints that deploy a complex environment comprising multiple grains and/or nested blueprints."}),"\n",(0,r.jsx)(n.h2,{id:"option-a-let-torque-generate-blueprints-from-your-assets",children:"Option A: Let Torque generate blueprints from your assets"}),"\n",(0,r.jsx)(n.p,{children:"When developing a new blueprint, Torque provides you with the ability to automatically discover the different IaC and Automation assets in your connected source control repository, and generate a blueprint for a single asset (or generate multiple single-asset blueprints in one go)."}),"\n",(0,r.jsxs)(n.p,{children:["These generated blueprints are stored in Torque's backend, and you can customize their inputs, outputs and other details as needed inside an embedded VSCode style IDE from within the Torque Portal. For details on what you can do with generated blueprints, see ",(0,r.jsx)(n.a,{href:"/blueprint-designer-guide/Autogenerated%20Blueprints",children:"Auto-generated Blueprints"}),"."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["In your space, go to ",(0,r.jsx)(n.strong,{children:"Settings > Repositories"})," and discover your assets."]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Locale Dropdown",src:t(7087).A+"",width:"1233",height:"431"})}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["Select one or more assets you want Torque to discover and click ",(0,r.jsx)(n.strong,{children:"Generate Blueprints"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Locale Dropdown",src:t(7608).A+"",width:"925",height:"687"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Torque creates a blueprint YAML for each selected asset, and lists the blueprints in your space\u2019s ",(0,r.jsx)(n.strong,{children:"Blueprints"})," page."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Locale Dropdown",src:t(7324).A+"",width:"1483",height:"381"})}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"You can click the blueprint to open it in the embedded VSCode editor. In this editor you can view the blueprint's contents, modify it, preview changes after modification, save the changes, and launch an environment from the blueprint."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"(Optional) You can set the blueprint's max duration policy, default duration, attach labels and colors to visually group blueprints according to shared  characteristics, or set the blueprint's tag values."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Locale Dropdown",src:t(7234).A+"",width:"413",height:"384"})}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Publish"})," the blueprints to your space's catalog and you\u2019re good to go."]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Locale Dropdown",src:t(1501).A+"",width:"678",height:"405"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["You and your space\u2019s users can now launch environments from these blueprints via the ",(0,r.jsx)(n.strong,{children:"Catalog"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"option-b-create-a-multi-asset-blueprint-in-your-source-control-repository",children:"Option B: Create a multi-asset blueprint in your source control repository"}),"\n",(0,r.jsx)(n.p,{children:"So far, we\u2019ve learned how to create single-asset blueprints via auto-generation. But what if you want to create an application-stack environment? This is easily done by having multiple grains in a single blueprint or nesting an existing blueprint within a master blueprint as a grain. To create such a blueprint, you will need an IDE environment that has access to a clone of your repository, in which you can create the new blueprint's YAML file and edit it, and then commit it into your repository and push the changes to the remote repository from which Torque will automatically synchronize the new blueprint."}),"\n",(0,r.jsx)(n.p,{children:"By enforcing usage of a source control repository, each blueprint in Torque will have:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A full history of tracked changes"}),"\n",(0,r.jsx)(n.li,{children:"The ability to identify which developer authored those changes"}),"\n",(0,r.jsx)(n.li,{children:"The ability to retrieve or rollback to the contents of previous versions of the blueprint file"}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsx)(n.mdxAdmonitionTitle,{children:(0,r.jsx)(n.strong,{children:"Tips"})}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If you are using VSCode to create and edit your blueprint file, we recommend using our official VSCode plugin (link here). For other IDEs, you can download our ",(0,r.jsx)(n.a,{href:"https://github.com/QualiTorque/torque-vs-code-extensions/blob/master/client/schemas/blueprint-spec2-schema.json",children:"official JSON schema"})," for the blueprint YAML and enforce it with your plugin of choice."]}),"\n",(0,r.jsx)(n.li,{children:"When connecting a repository containing blueprint files to Torque, it is possible to reference a branch of the repository and not its main, allowing designers the ability to test changes to blueprints before pushing them to the main/master branch and affecting the production catalog."}),"\n"]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"To create a multi-asset blueprint:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Generate a single-asset blueprint for the first grain in your blueprint, as explained in ",(0,r.jsx)(n.a,{href:"#option-a-let-torque-generate-blueprints-from-your-assets",children:"Let Torque auto-generate blueprints from your assets"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Download the blueprint as a file from Torque."}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Locale Dropdown",src:t(6246).A+"",width:"1126",height:"248"})}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:'Save the file in the "/blueprints" folder in your cloned repository (create it if it doesn\'t exist) and rename it to the name of the new blueprint.'}),"\n",(0,r.jsx)(n.li,{children:"Modify the grain type and spec to reflect the new component of your environment. For example:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:'language-"yaml',children:"grains:\ndatabase:\n  kind: terraform\n  spec:\n    source:\n      store: infra \n      path: terraform/rds\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsxs)(n.li,{children:["For each additional grain, do one of the following:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Copy an example of that grain from a generated blueprint."}),"\n",(0,r.jsxs)(n.li,{children:["Use the sample structure for that grain type in the corresponding page in ",(0,r.jsx)(n.a,{href:"/blueprint-designer-guide/blueprints/blueprints-overview",children:"The Blueprint YAML"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["If grains depend on each other, add a ",(0,r.jsx)(n.code,{children:"depends-on"})," section to the grain (in the top level, next to ",(0,r.jsx)(n.code,{children:"kind:"})," and ",(0,r.jsx)(n.code,{children:"spec:"}),") and provide the names of the dependent grains in a comma-separated list."]}),"\n",(0,r.jsxs)(n.li,{children:["Once a grain depends on another grain, the output values from that grain can be used as values for any of the grain's inputs or attributes using the syntax ",(0,r.jsx)(n.code,{children:"{{ .grains.grain_name.outputs.output_name}}"}),", see the examples below."]}),"\n",(0,r.jsxs)(n.li,{children:["Customize the ",(0,r.jsx)(n.code,{children:"inputs"})," and ",(0,r.jsx)(n.code,{children:"outputs"})," sections of the blueprint to contain only the relevant inputs that the entire environment needs, and to reflect the outputs from the grains that you would like to make available to the environment's end-user."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"removing-a-blueprint",children:"Removing a blueprint"}),"\n",(0,r.jsx)(n.p,{children:"As mentioned above, there are two types of blueprints, auto-generated blueprints (stored in Torque) and source-controlled blueprints (stored in your repository)."}),"\n",(0,r.jsxs)(n.p,{children:["To delete an auto-generated blueprint, in the ",(0,r.jsx)(n.strong,{children:"Blueprints"})," page, click the blueprint's more options button and select ",(0,r.jsx)(n.strong,{children:"Remove"}),"."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Locale Dropdown",src:t(541).A+"",width:"405",height:"358"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"To delete a repository blueprint, delete the blueprint file from the repository's branch that the Torque space is connected to."}),"\n",(0,r.jsx)(n.h2,{id:"example-multi-grain-blueprint-1-helm-application-with-mysql-and-s3-deployed-by-terraform",children:"Example multi-grain blueprint 1: Helm Application with MySQL and S3 Deployed by Terraform"}),"\n",(0,r.jsxs)(n.p,{children:["This blueprint is available in the ",(0,r.jsx)(n.strong,{children:"Sample"})," space ",(0,r.jsx)(n.a,{href:"https://portal.qtorque.io/Sample/blueprints/%5BSample%5DHelm%20Application%20with%20MySql%20and%20S3%20Deployed%20by%20Terraform",children:"here"}),", which deploys 2 Terraform modules and a Helm chart:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:"title=",children:"spec_version: 2\ndescription: Robotshop microservices application deployed on K8S with Helm and RDS deployed with TF\n\noutputs:\n  WebsiteUrl:\n    kind: link\n    value: 'https://portal.qtorque.io/static/demo-quick-links/stans-robot-shop.html'\n\n\ngrains:\n  mySqlDB:\n    kind: terraform\n    spec:\n      source:\n        path: github.com/QualiTorque/samples.git//terraform/rds\n      agent:\n        name: eks-demo\n      inputs:\n        - sandbox_id: '{{ sandboxid | downcase }}'\n        - size: small \n        - allocated_storage: 20\n        - db_name: demo_db\n        - engine_version: 8.0.26\n        - engine: MySQL\n        - username: adminuser\n        - vpc_id: vpc-02e3bca90b081cd0f\n        - region: us-east-1\n      outputs:\n        - hostname\n        - connection_string\n\n  s3Bucket:\n    kind: terraform\n    spec: \n      source:\n        path: github.com/QualiTorque/samples.git//terraform/s3\n      agent:\n        name: eks-demo\n      inputs:\n        - region: eu-west-1\n        - acl: public-read\n        - name: 'robotshop-s3-{{ sandboxid | downcase }}'\n      outputs:\n        - s3_bucket_arn\n\n  robotShopMicroservices:\n    kind: helm\n    depends-on: mySqlDB, s3Bucket\n    spec:\n      source:\n        path: https://github.com/QualiTorque/samples.git//helm/robotshop\n      agent:\n        name: eks-demo\n      inputs:\n        - hostname: 'robotshop-{{ sandboxid | downcase }}'\n        - version: 0.4.3\n        - connectionString: '{{ .grains.mySqlDB.outputs.connection_string }}'\n        - objectStore.s3BucketArn: '{{ .grains.s3Bucket.outputs.s3_bucket_arn }}'\n        - redis.storageClassName: gp2\n"})}),"\n",(0,r.jsx)(n.h2,{id:"example-multi-grain-blueprint-2-web-game-on-s3-using-cloudformation-and-terraform",children:"Example multi-grain blueprint 2: Web-game on S3 (using CloudFormation and Terraform)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:"title=",children:'spec_version: 2\ndescription: "S3 Bucket creation with Input and Output parameters"\n\ninputs:\n   # The access_control property is case-sensitive and must be one of the following values: \n   # Private, PublicRead, PublicReadWrite, AuthenticatedRead, LogDeliveryWrite, BucketOwnerRead, BucketOwnerFullControl, or AwsExecRead\n   Access Control:\n      type: string\n      description: >\n        Type of access to configure on Bucket objects: Private, PublicRead, PublicReadWrite, AuthenticatedRead,\n        LogDeliveryWrite, BucketOwnerRead, BucketOwnerFullControl, or AwsExecRead\n      default: "PublicRead"\n      allowed-values: ["Private", "PublicRead", "PublicReadWrite"]\n   Bucket Name:\n      type: string\n      default: my-bucket-test\n   AWS Region:\n      description: "The name of the AWS Region to use"\n      default: "us-west-1"\n      allowed-values: ["us-west-1", "us-west-2", "eu-west-1"]\n    \n\noutputs:\n   S3 Bucket ARN:\n        value: \'{{ .grains.my-S3-Bucket.outputs.Arn }}\'\n   S3 Bucket Domain Name:\n        value: \'{{ .grains.my-S3-Bucket.outputs.DomainName }}\'\n        kind: link\n   Webgame Link:\n        value: \'{{ .grains.S3-Upload-Webapp-File.outputs.website_link }}\'\n        kind: link\n\ngrains:\n  CFN-S3-Bucket:\n    kind: cloudformation\n    spec: \n      source:\n        path: https://.../AWSS3Bucket.yaml\n      region: \'{{ .inputs.["AWS Region"] }}\'\n      agent:\n        name: demo-prod\n        service-account: app-sa\n      inputs:\n        - AccessControl: \'{{ .inputs.["Access Control"] }}\'\n        - BucketName: \'{{ .inputs.["Bucket Name"] }}-{{ sandboxid | downcase }}\'\n      outputs:\n         - Arn\n         - DomainName\n      template-storage:\n         bucket-name: my-bucket\n         region: us-east-1\n         key-prefix: temp-cfn\n  \n  S3-Upload-Webapp-File:\n    kind: terraform\n    depends-on: my-S3-Bucket\n    spec:\n      source:\n        store: assets\n        path: assets/terraform/s3-deploy-webapp\n      agent:\n        name: demo-prod\n        service-account: app-sa\n      inputs:\n      - bucket_name: \'{{ .inputs.["Bucket Name"] }}-{{ sandboxid | downcase }}\'\n      - region: \'{{ .inputs.["AWS Region"] }}\'\n      outputs:\n      - website_link\n    # The terraform version that will be used to deploy the module\n    tf-version: 1.2.3\n\n'})})]})}function c(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},7234:function(e,n,t){t.d(n,{A:()=>i});let i=t.p+"assets/images/blueprint-options-b9a80b8654c561441ca265d63cfca6fe.png"},7087:function(e,n,t){t.d(n,{A:()=>i});let i=t.p+"assets/images/discover-assets-0a2937b3d793f687123a994daf6ee531.png"},6246:function(e,n,t){t.d(n,{A:()=>i});let i=t.p+"assets/images/download_blueprint-yaml-922e008272cf80ab7cf841d6de9b1d3b.png"},7324:function(e,n,t){t.d(n,{A:()=>i});let i=t.p+"assets/images/new-assets-9dea11e9582ddde3dd5212cd834df2d9.png"},1501:function(e,n,t){t.d(n,{A:()=>i});let i=t.p+"assets/images/publish-blueprint-3256f4e957a35dbfc3167532de769a61.png"},541:function(e,n,t){t.d(n,{A:()=>i});let i=t.p+"assets/images/remove-blueprint-d11d215b53950d893ecfc50e7f9a5115.png"},7608:function(e,n,t){t.d(n,{A:()=>i});let i=t.p+"assets/images/select-assets-d2c268b7b3d1da83e89563a8dabd7e6f.png"},4429:function(e,n,t){t.d(n,{R:()=>s,x:()=>a});var i=t(6540);let r={},o=i.createContext(r);function s(e){let n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);