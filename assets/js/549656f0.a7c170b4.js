"use strict";(self.webpackChunktorque=self.webpackChunktorque||[]).push([[4163],{3905:function(e,t,r){r.d(t,{Zo:function(){return l},kt:function(){return m}});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var i=n.createContext({}),u=function(e){var t=n.useContext(i),r=t;return e&&(r="function"==typeof e?e(t):c(c({},t),e)),r},l=function(e){var t=u(e.components);return n.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=u(r),m=o,h=d["".concat(i,".").concat(m)]||d[m]||p[m]||a;return r?n.createElement(h,c(c({ref:t},l),{},{components:r})):n.createElement(h,c({ref:t},l))}));function m(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,c=new Array(a);c[0]=d;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:o,c[1]=s;for(var u=2;u<a;u++)c[u]=r[u];return n.createElement.apply(null,c)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},7054:function(e,t,r){r.r(t),r.d(t,{assets:function(){return l},contentTitle:function(){return i},default:function(){return m},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return p}});var n=r(7462),o=r(3366),a=(r(7294),r(3905)),c=["components"],s={sidebar_position:10,title:"Service Accounts"},i=void 0,u={unversionedId:"getting-started/Service Accounts",id:"getting-started/Service Accounts",title:"Service Accounts",description:"A kubernetes service account provides an identity for processes that run in a Pod. We recommends using service accounts if you are using a K8s cluster as your execution host.",source:"@site/docs/getting-started/Service Accounts.md",sourceDirName:"getting-started",slug:"/getting-started/Service Accounts",permalink:"/torque-docs/getting-started/Service Accounts",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/getting-started/Service Accounts.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10,title:"Service Accounts"},sidebar:"torqueSidebar",previous:{title:"Connect a Kubernetes Cluster",permalink:"/torque-docs/getting-started/Connect a Kubernetes Cluster"},next:{title:"Create a Page",permalink:"/torque-docs/use-cases-best-practices/create-a-page"}},l={},p=[{value:"Helm charts",id:"helm-charts",level:3},{value:"Terraform modules",id:"terraform-modules",level:3},{value:"AWS",id:"aws",level:4},{value:"Steps",id:"steps",level:5}],d={toc:p};function m(e){var t=e.components,r=(0,o.Z)(e,c);return(0,a.kt)("wrapper",(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"A kubernetes service account provides an identity for processes that run in a Pod. We recommends using service accounts if you are using a K8s cluster as your execution host.\nThe service account is specified in the blueprint, inside the grain section, in the host node:"),(0,a.kt)("p",null,"Blueprint yaml:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"...\ngrains:\n  my-grain-name:\n    kind : terraform \n    spec:\n      ...\n      host:\n        name : <execution-host-name>\n        serivce-account : <service-account-name>\n      ...  \n")),(0,a.kt)("h3",{id:"helm-charts"},"Helm charts"),(0,a.kt)("p",null,"When you're deploying resources in the cluster using a helm chart, the service account used should have sufficient permissions to create all the resources which the chart will deploy. For detailed documentation, see ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/rbac/#service-account-permissions"},"service-account-permissions")),(0,a.kt)("h3",{id:"terraform-modules"},"Terraform modules"),(0,a.kt)("h4",{id:"aws"},"AWS"),(0,a.kt)("p",null,"If you're using an EKS cluster as your execution host, and you want to deploy resources to the same or another AWS account, you can use service account to do the authentication and permissions between the POD and the AWS account where the resources will be created."),(0,a.kt)("h5",{id:"steps"},"Steps"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Create an IAM OIDC provider for your cluster (",(0,a.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/eks/latest/userguide/enable-iam-roles-for-service-accounts.html"},"Instructions"),").")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Create an IAM role on the target account, to be assumed by the service account on the source cluster. (",(0,a.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/eks/latest/userguide/create-service-account-iam-policy-and-role.html"},"Instructions"),").")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Associate the IAM role to a service account on your cluster (",(0,a.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/eks/latest/userguide/specify-service-account-role.html"},"Instructions\u200b"),")."))),(0,a.kt)("p",null,"If the TF resources are to be created in a different AWS account than the one hosting the EKS cluster which is our execution host, you'll need to do (1) and (2) on the target account. See ",(0,a.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts-technical-overview.html"},"Documentation"),"."))}m.isMDXComponent=!0}}]);