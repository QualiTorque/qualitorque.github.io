---
sidebar_position: 27
title: The Blueprint Grain
---

### source
Please see [the grain source](/blueprint-designer-guide/blueprints/blueprints-yaml-structure#source) for more details.

### agent
Please see [the grain agent](/blueprint-designer-guide/blueprints/blueprints-yaml-structure#host) for more details.

### inputs
Similar to blueprint inputs, the Terraform grain input allows you to reuse the same Terraform module in different ways. Inputs provided to the Terraform grain are used when launching the Terraform module. Terraform grain inputs should be listed in the order defined in the module's variables.tf file. We recommend using Torque's auto-discovery capability to quickly model your Terraform modules within Torque including all defined inputs.

Every value that goes to the Terraform grain's input is interpreted as a json token. So you can pass any valid value by json: number, list, dictionary, boolean, string , etc.
For details, check out this Terraform Docs section [Variable Definitions (.tfvars) Files](https://www.terraform.io/language/values/variables#variable-definitions-tfvars-files)

Example:

```yaml
grains:
  database:
    kind: terraform
    spec:
      source:
        store: infra 
        path: terraform/rds
      authentication:
        - ...        
      ...
      inputs:
        - database_size: '{{ .inputs.db_size }}' 
        - database_name: '{{ .inputs.db_name }}' 
        - input_number: 6
        - input_string: '{" this is my input string "}'
        - input_list_strings: '["a","b","c"]'
        - input_map_strings: '{ "key1":"val1", "key2":"val2" }'
        - input_object: '{ "key1":val1, "key2":4 }'
```

:::info
Note that in the above example, some blueprint inputs are used as the values of the Terraform grain inputs, so the environment's owner is able to choose the db_size and db_name required for his need. The information provided by the user will be passed to Terraform and affect the deployment process. The blueprint input type is always "string". the actual parsing of the json type will be done automatically.
:::



Note that invalid tokens will be parsed as strings. Keep in mind that json strings require double quotes, so ```"my value``` is a string but ```my value``` is not a valid json value and therefore will also be passed as a string. As such, the following values will all be passed as strings: ```"my value"```, ```my value```, ```"[1,2,3]"```

### outputs 
Output are values generated by Terraform during the deployment process. Outputs should be defined in the outputs.tf file located in the Terraform module folder. We recommend using Torque's auto-discovery capability to quickly model your Terraform modules within Torque including it's defined outputs.


```yaml 
grains:
  database:
    kind: terraform
    spec:
      source:
        path: github.com/org/repo.git//terraform/rds
      ...
      outputs:
        - agent_name
        - connection_string
```

### How to create a blueprint grain
__To nest a blueprint as a grain in another blueprint:__
1. Open the new blueprint's YAML file.
2. Add a new grain to the ```grains``` section.
3. Define the grain's details. These are the mandatory settings:
    * Change the __kind_ param to: ```kind: blueprint```
    * In __store__, specify the name of the blueprint repository defined in the space.
    * In __path__, specify ```blueprints/<blueprint file name without ".yaml">```. Alternatively, specify only ```blueprints``` and change the grain name to the blueprint file name without ".yaml".
    * Specify the agent as an input of ```type: execution-host``` on the blueprint level, and reference it from the grain, both as an input and in the host section.
6. If the grain should run after the deployment of another grain, add ```__depends_on: <name of grain dependency>```:
  ```jsx title=
grains:
  my-nested-blueprint-grain:
    kind: blueprint
    depends-on: infra-grain
    spec: 
      source:
        store: <space's blueprint repository>
        path: blueprints/<blueprint file name without ".yaml">
      host:
        name: prod-host
      inputs:
        - my-excution-host: prod-host 
7. Define the rest of the grain's settings as appropriate. For details, see [Blueprint YAML](/blueprint-designer-guide/blueprints/blueprints-overview).